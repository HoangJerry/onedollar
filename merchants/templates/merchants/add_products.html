{% extends 'merchants/base.html' %}
{% load staticfiles %}

{% block style %}
  <!-- For upload -->
  <link href="{% static 'merchants/css/fileinput.css' %}" media="all" rel="stylesheet" type="text/css"/>
  <link href="{% static 'merchants/themes/explorer/theme.css' %}" media="all" rel="stylesheet" type="text/css"/>
  <script src="{% static 'merchants/js/plugins/sortable.js' %}" type="text/javascript"></script>
  <script src="{% static 'merchants/js/fileinput.js' %}" type="text/javascript"></script>
  <script src="{% static 'merchants/themes/explorer/theme.js' %}" type="text/javascript"></script>
  <!-- Style page -->
  <link rel="stylesheet" type="text/css" href="{% static 'merchants/css/add_products_page.css' %}">
{% endblock %}

{% block header_pull_right %}
{% endblock %}

{% block sub_header_nav %}

{% endblock %}

{% block content %}
  <div id="add-products-page" class="center">
    <div>
      <!-- NOTE: if you update this, make sure the add product page in onboarding flow still works --> 
      <legend>Add Products</legend>
      <div style="margin: 0 auto; width: 50%; text-align:center"> Having trouble? <a target="_blank" class="signup_guide_link" href=""> Check out the signup guide </a> </div>
      <div id="add-product-form">
        <div id="basic-info" class="form-horizontal">
          <div class="section-title">Basic Information</div>
          <div class="control-group">
            <label class="control-label" data-col-index="3"> <span class="col-name">Product Name</span>  </label> 
            <div class="controls input-append">   <input class="input-block-level required" name="title" type="text" value="" placeholder="Acceptable: Men&#39;s Dress Casual Shirt Navy">  <span class="add-on"><i class="icon-pencil"></i></span> </div>
          </div>
          <div class="control-group">
            <label class="control-label" data-col-index="8"> <span class="col-name">Description</span>  </label> 
            <div class="controls input-append">   <textarea rows="5" class="input-block-level required" name="description" type="text" value="" placeholder="Acceptable: This dress shirt is 100% cotton and fits true to size."></textarea>  <span class="add-on"><i class="icon-pencil"></i></span> </div>
          </div>
          <div class="control-group">
            <label class="control-label" data-col-index="7"> <span class="col-name">Tags</span>  </label> 
            <div class="controls input-append">
              <ul class="typeahead-tokenizer">
                <li class="token-li first-li"><input name="tags" class="token-input " type="text" placeholder="Acceptable: Shirt, Men&#39;s Fashion, Navy, Blue, Casual, Apparel"></li>
              </ul>
              <span class="add-on"><i class="icon-pencil"></i></span> 
            </div>
          </div>
          <div class="control-group" id="unique_id_lvnt">
            <label class="control-label" data-col-index="1"> <span class="col-name">Unique Id</span>  </label> 
            <div class="controls input-append">   <input class="input-block-level required" name="unique_id" type="text" value="" placeholder="Acceptable: HSC0424PP">  <span class="add-on"><i class="icon-pencil"></i></span> </div>
          </div>
          <div class="control-group">
            <label class="control-label" data-col-index="1"> <span class="col-name">Category</span>  </label> 
            <div class="controls input-append">
              <select class="input-block-level required" id="category">
              </select>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" data-col-index="1"> <span class="col-name">Brand (not required)</span>  </label> 
            <div class="controls input-append">
              <select class="input-block-level required" id="brand">
                <option value=""></option>
              </select>
            </div>
          </div>
        </div>
        <div id="main-image" class="form-horizontal">
          <div class="section-title"> Main Image </div>
          <div class="clearfix">
            <div id="main-image-div" class="dropzone text-center pull-left">
              <form enctype="multipart/form-data">
                <div class="form-group">
                  <input id="input-4" name="photos" type="file" class="file file-loading" data-show-upload="false" data-show-caption="false" data-allowed-file-extensions='["png", "jpg", "jpeg"]' data-upload-url="#">
                </div>
              </form>
              <script>
                $("#input-4").fileinput({
                  layoutTemplates: {
                    actions: '',
                  },
                });
              </script>
            </div>
            <div class="add-image-info pull-left">
              <div class="add-image-info-text"> <a target="_blank" href="{% url "index" %}hc/articles/204531768-What-constitutes-as-a-fake-or-a-counterfeit-item-"> Counterfeit products are prohibited on Wish. </a> </div>
              <div class="add-image-info-text"> Products with multiple high quality images get the most sales. </div>
              <div class="add-image-info-text"> Add images that are at least 800x800 pixels. </div>
              <div class="add-image-info-text"> Do not steal images from other merchants, or your product will be deleted. </div>
              <div class="add-image-info-text"> For more information on intellectual property rules, check out the <a target="_blank" href="{% url "index" %}brand-university"> Brand University </a> <sup style="color:red">New</sup> </div>
            </div>
          </div>
          <div class="section-title"> Additional Images </div>
          <div id="extra-image-div" class="clearfix dropzone">
            <form enctype="multipart/form-data">
              <div class="form-group">
                <input id="input-5" name="photos" type="file" class="file file-loading" data-show-upload="false" data-show-caption="false" data-allowed-file-extensions='["png", "jpg", "jpeg"]' multiple data-upload-url="#">
              </div>
            </form>
            <script>
              $("#input-5").fileinput({
                layoutTemplates: {
                  actions: '',
                },
              });
            </script>
          </div>
        </div>
        <div id="inventory-shipping" class="form-horizontal earnings-section">
          <div class="section-title">Inventory and Shipping</div>
          <div class="control-group">
            <label class="control-label" data-col-index="2"> <span class="col-name">Price</span>  </label> 
            <div class="controls input-append">   <input class="input-block-level required" name="buying_price" type="text" value="" placeholder="Acceptable: $100.99">  <span class="add-on"><i class="icon-pencil"></i></span> </div>
          </div>
          <div class="control-group">
            <label class="control-label" data-col-index="4"> <span class="col-name">Quantity</span>  </label> 
            <div class="controls input-append">   <input class="input-block-level required" name="orders_count" type="text" value="" placeholder="Acceptable: 1200">  <span class="add-on"><i class="icon-pencil"></i></span> </div>
          </div>
          <div class="control-group">
            <label class="control-label" data-col-index="5"> <span class="col-name">Shipping</span>  </label> 
            <div class="controls input-append">   <input class="input-block-level required" name="shipping_cost" type="text" value="" placeholder="Acceptable: $4.00">  <span class="add-on"><i class="icon-pencil"></i></span> </div>
          </div>
          <div class="control-group">
            <label class="control-label"> <span> Earnings</span> </label> 
            <div class="controls input-append"> <input class="input-block-level" type="text" id="earnings" disabled=""> </div>
          </div>
          <input type="hidden" name="Shipping Time" id="shipping-time-submit"> 
          <div id="shipping-time">
            <div class="control-label"> Shipping Time </div>
            <div id="common-ship-time">
              <label class="ship-time-labels"> <input type="radio" class="ship-time-checkbox" name="ship-time-checkbox" value="0" checked=""> 0 </label><label class="ship-time-labels"> <input type="radio" class="ship-time-checkbox" name="ship-time-checkbox" value="1"> 5 - 10 </label>    <label class="ship-time-labels"> <input type="radio" class="ship-time-checkbox" name="ship-time-checkbox" value="2"> 7 - 14 </label>    <label class="ship-time-labels"> <input type="radio" class="ship-time-checkbox" name="ship-time-checkbox" value="3"> 10 - 15 </label>    <label class="ship-time-labels"> <input type="radio" class="ship-time-checkbox" name="ship-time-checkbox" value="4"> 14 - 21 </label>    <label class="ship-time-labels"> <input type="radio" class="ship-time-checkbox" name="ship-time-checkbox" value="5"> 21 - 28 </label>   
            </div>
          </div>
        </div>
        <div id="colors-info" class="form-horizontal">
          <div class="section-title"> Colors </div>
          <div id="colors-selection" class="colors-selection">
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="White" display-name="White" color-hex="#FFFFFF">  
              <div class="color-box" style="background-color: #FFFFFF"> </div>
              White 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Black" display-name="Black" color-hex="#000000">  
              <div class="color-box" style="background-color: #000000"> </div>
              Black 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Red" display-name="Red" color-hex="#FF0000">  
              <div class="color-box" style="background-color: #FF0000"> </div>
              Red 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Blue" display-name="Blue" color-hex="#0000FF">  
              <div class="color-box" style="background-color: #0000FF"> </div>
              Blue 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Green" display-name="Green" color-hex="#00FF00">  
              <div class="color-box" style="background-color: #00FF00"> </div>
              Green 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Grey" display-name="Grey" color-hex="#808080">  
              <div class="color-box" style="background-color: #808080"> </div>
              Grey 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Brown" display-name="Brown" color-hex="#A52A2A">  
              <div class="color-box" style="background-color: #A52A2A"> </div>
              Brown 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Tan" display-name="Tan" color-hex="#D2B48C">  
              <div class="color-box" style="background-color: #D2B48C"> </div>
              Tan 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Beige" display-name="Beige" color-hex="#F5F5DC">  
              <div class="color-box" style="background-color: #F5F5DC"> </div>
              Beige 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Pink" display-name="Pink" color-hex="#FF69B4">  
              <div class="color-box" style="background-color: #FF69B4"> </div>
              Pink 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Orange" display-name="Orange" color-hex="#FFA500">  
              <div class="color-box" style="background-color: #FFA500"> </div>
              Orange 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Yellow" display-name="Yellow" color-hex="#FFFF00">  
              <div class="color-box" style="background-color: #FFFF00"> </div>
              Yellow 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Ivory" display-name="Ivory" color-hex="#FFFFF0">  
              <div class="color-box" style="background-color: #FFFFF0"> </div>
              Ivory 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="NavyBlue" display-name="Navy Blue" color-hex="#000080">  
              <div class="color-box" style="background-color: #000080"> </div>
              Navy Blue 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Purple" display-name="Purple" color-hex="#800080">  
              <div class="color-box" style="background-color: #800080"> </div>
              Purple 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Gold" display-name="Gold" color-hex="#FFD700">  
              <div class="color-box" style="background-color: #FFD700"> </div>
              Gold 
            </label>
            <label class="color-labels">
              <input type="checkbox" class="colours-row-checkbox" name="colors" value="Multicolor" display-name="Multicolor" color-hex="url">  
              <div class="color-box color-box-image" style="background-image: url(&#39;https://main.cdn.merchant.wish.com/c9971081a477/img/multicolor.png&#39;)"> </div>
              Multicolor 
            </label>
          </div>
        </div>
        <div id="sizes-info" class="form-horizontal">
          <div class="section-title"> Sizing </div>
          <div id="sizes-selection" class="tabbable">
            <ul class="nav nav-pills">
              <li><a href="{% url "index" %}add-products#size-category-tab-18" data-toggle="tab"> Men's Apparel </a></li>
              <li class="active"><a href="{% url "index" %}add-products#size-category-tab-19" data-toggle="tab"> Women's Apparel </a></li>
            </ul>
          </div>
          <div class="tab-content">
            <div id="size-category-tab-18" class="tab-pane">
              <div class="size-category-checkbox-section"></div>
              <div class="size-category-add-section"> </div>
              <div class="size-category-size-chart">
                <div>
                  <div class="size-chart">
                    <h3>Men's Apparel</h3>
                    <table class="table table-striped table-bordered table-hover">
                      <thead>
                        <tr>
                          <th rowspan="2"></th>
                          <th class="th-dim" colspan="2"> Chest  </th>
                          <th class="th-dim" colspan="2"> Waist  </th>
                          <th class="th-dim" colspan="2"> Neck  </th>
                          <th class="th-dim" colspan="2"> Sleeve  </th>
                        </tr>
                        <tr>
                          <th class="th-unit">Centimeters</th>
                          <th class="th-unit">Inches</th>
                          <th class="th-unit">Centimeters</th>
                          <th class="th-unit">Inches</th>
                          <th class="th-unit">Centimeters</th>
                          <th class="th-unit">Inches</th>
                          <th class="th-unit">Centimeters</th>
                          <th class="th-unit">Inches</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="XS" display-name="XS"> XS </label>  </td>
                          <td>76 - 81 (cm)</td>
                          <td>30" - 32"</td>
                          <td>61 - 66 (cm)</td>
                          <td>24" - 26"</td>
                          <td>33 - 34 (cm)</td>
                          <td>13" - 13.5"</td>
                          <td>79 - 81 (cm)</td>
                          <td>31" - 32"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="S" display-name="S"> S </label>  </td>
                          <td>86 - 91 (cm)</td>
                          <td>34" - 36"</td>
                          <td>71 - 76 (cm)</td>
                          <td>28" - 30"</td>
                          <td>36 - 37 (cm)</td>
                          <td>14" - 14.5"</td>
                          <td>81 - 84 (cm)</td>
                          <td>32" - 33"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="M" display-name="M"> M </label>  </td>
                          <td>97 - 102 (cm)</td>
                          <td>38" - 40"</td>
                          <td>81 - 86 (cm)</td>
                          <td>32" - 34"</td>
                          <td>38 - 39 (cm)</td>
                          <td>15" - 15.5"</td>
                          <td>84 - 86 (cm)</td>
                          <td>33" - 34"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="L" display-name="L"> L </label>  </td>
                          <td>107 - 112 (cm)</td>
                          <td>42" - 44"</td>
                          <td>91 - 97 (cm)</td>
                          <td>36" - 38"</td>
                          <td>41 - 42 (cm)</td>
                          <td>16" - 16.5"</td>
                          <td>86 - 89 (cm)</td>
                          <td>34" - 35"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="XL" display-name="XL"> XL </label>  </td>
                          <td>117 - 122 (cm)</td>
                          <td>46" - 48"</td>
                          <td>102 - 107 (cm)</td>
                          <td>40" - 42"</td>
                          <td>43 - 44 (cm)</td>
                          <td>17" - 17.5"</td>
                          <td>89 - 91 (cm)</td>
                          <td>35" - 36"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="XXL" display-name="XXL"> XXL </label>  </td>
                          <td>127 - 132 (cm)</td>
                          <td>50" - 52"</td>
                          <td>112 - 117 (cm)</td>
                          <td>44" - 46"</td>
                          <td>46 - 47 (cm)</td>
                          <td>18" - 18.5"</td>
                          <td>91 - 94 (cm)</td>
                          <td>36" - 37"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="XXXL" display-name="XXXL"> XXXL </label>  </td>
                          <td>137 - 142 (cm)</td>
                          <td>54" - 56"</td>
                          <td>122 - 127 (cm)</td>
                          <td>48" - 50"</td>
                          <td>48 - 50 (cm)</td>
                          <td>19" - 19.5"</td>
                          <td>94 - 97 (cm)</td>
                          <td>37" - 38"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="XXXXL" display-name="XXXXL"> XXXXL </label>  </td>
                          <td>147 - 152 (cm)</td>
                          <td>58" - 60"</td>
                          <td>132 - 137 (cm)</td>
                          <td>52" - 54"</td>
                          <td>51 - 52 (cm)</td>
                          <td>20" - 20.5"</td>
                          <td>97 - 99 (cm)</td>
                          <td>38" - 39"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="XXXXXL" display-name="XXXXXL"> XXXXXL </label>  </td>
                          <td>157 - 163 (cm)</td>
                          <td>62" - 64"</td>
                          <td>142 - 147 (cm)</td>
                          <td>56" - 58"</td>
                          <td>53 - 55 (cm)</td>
                          <td>21" - 21.5"</td>
                          <td>99 - 102 (cm)</td>
                          <td>39" - 40"</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div id="size-category-tab-19" class="tab-pane active">
              <div class="size-category-checkbox-section"></div>
              <div class="size-category-add-section"> </div>
              <div class="size-category-size-chart">
                <div>
                  <div class="size-chart">
                    <h3>Women's Apparel</h3>
                    <table class="table table-striped table-bordered table-hover">
                      <thead>
                        <tr>
                          <th rowspan="2"></th>
                          <th class="th-dim" colspan="2"> Bust/Chest  </th>
                          <th class="th-dim" colspan="2"> Waist  </th>
                          <th class="th-dim" colspan="2"> Hip  </th>
                        </tr>
                        <tr>
                          <th class="th-unit">Centimeters</th>
                          <th class="th-unit">Inches</th>
                          <th class="th-unit">Centimeters</th>
                          <th class="th-unit">Inches</th>
                          <th class="th-unit">Centimeters</th>
                          <th class="th-unit">Inches</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="XXS" display-name="XXS"> XXS </label>  </td>
                          <td>80 - 83 (cm)</td>
                          <td>31.5" - 32.5"</td>
                          <td>60 - 62 (cm)</td>
                          <td>23.5" - 24.5"</td>
                          <td>86 - 89 (cm)</td>
                          <td>34" - 35"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="XS" display-name="XS"> XS </label>  </td>
                          <td>83 - 85 (cm)</td>
                          <td>32.5" - 33.5"</td>
                          <td>62 - 65 (cm)</td>
                          <td>24.5" - 25.5"</td>
                          <td>89 - 91 (cm)</td>
                          <td>35" - 36"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="S" display-name="S"> S </label>  </td>
                          <td>85 - 88 (cm)</td>
                          <td>33.5" - 34.5"</td>
                          <td>65 - 67 (cm)</td>
                          <td>25.5" - 26.5"</td>
                          <td>91 - 94 (cm)</td>
                          <td>36" - 37"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="M" display-name="M"> M </label>  </td>
                          <td>90 - 93 (cm)</td>
                          <td>35.5" - 36.5"</td>
                          <td>70 - 72 (cm)</td>
                          <td>27.5" - 28.5"</td>
                          <td>97 - 99 (cm)</td>
                          <td>38" - 39"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="L" display-name="L"> L </label>  </td>
                          <td>97 - 100 (cm)</td>
                          <td>38" - 39.5"</td>
                          <td>76 - 80 (cm)</td>
                          <td>30" - 31.5"</td>
                          <td>103 - 107 (cm)</td>
                          <td>40.5" - 42"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="XL" display-name="XL"> XL </label>  </td>
                          <td>104 - 109 (cm)</td>
                          <td>41" - 43"</td>
                          <td>84 - 88 (cm)</td>
                          <td>33" - 34.5"</td>
                          <td>110 - 116 (cm)</td>
                          <td>43.5" - 45.5"</td>
                        </tr>
                        <tr>
                          <td>  <label> <input type="checkbox" class="sizes-row-checkbox" name="sizes" value="XXL" display-name="XXL"> XXL </label>  </td>
                          <td>110 - 116 (cm)</td>
                          <td>43.5" - 45.5"</td>
                          <td>91 - 95 (cm)</td>
                          <td>36" - 37.5"</td>
                          <td>116 - 123 (cm)</td>
                          <td>45.5" - 48.5"</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div id="add-variations" class="form-horizontal">
          <div class="section-title">Product Variations</div>
          <div id="variations-section" class="variations-section">
            <div id="variations-heading" class="hide">
              <h5 class="variation-heading-size">Size</h5>
              <h5 class="variation-heading-color">Color</h5>
              <h5 class="variation-input-large">Unique Id (SKU)</h5>
              <h5 class="variation-input-small">Price</h5>
              <h5 class="variation-input-small">Quantity</h5>
              <h5 class="variation-input-earnings">Earnings</h5>
            </div>
          </div>
        </div>
        <div id="summary-action" class="form-horizontal">
          <div class="section-title">Summary</div>
          <div class="control-group text-center">
            <div id="summary-info" class="alert alert-info hide"> Creating <span id="product-name"></span> with <span id="variations-count">0</span> variations </div>
          </div>
          <div id="buttons-section" class="control-group text-right">
             <!-- <button id="clear-button" class="btn btn-large">Clear</button>  -->
            <button id="submit-button" type="submit" class="btn btn-primary btn-large">Submit</button>  
            <div id="loading-spinner" class="loading" style="display: none;"></div>
          </div>
        </div>
      </div>
      <div style="margin: 0 auto; width: 50%; text-align:center"> Having trouble? <a target="_blank" class="signup_guide_link" href="{% url "index" %}hc/en-us/articles/219188967#step8"> Check out the signup guide </a> </div>
    </div>
  </div>
{% endblock %}

{% block global_js %}
<script type="text/javascript">

$( document ).ready(function() {
  // Remove modal FileUpload
  $('#kvFileinputModal').remove();

  // Create data category + category_new
  // $.ajax({
  //   type: "GET",
  //   beforeSend: function(request) {
  //     request.setRequestHeader("Authorization", 'Token ' + localStorage.getItem('token'));
  //   },
  //   url: '/api/shop/categories/',
  //   dataType: "json",
  //   success: function (data) {
  //     let oneTime = true;
  //     data.results.map(function(obj, key){
          
  //         let tmpl = `<option value="${obj.id}">${obj.link}</option>`;
  //         $('#category').append(tmpl);

  //     });
  //   }
  // });

  $.ajax({
    type: "GET",
    beforeSend: function(request) {
      request.setRequestHeader("Authorization", 'Token ' + localStorage.getItem('token'));
    },
    url: '/api/categories/test/',
    dataType: "json",
    success: function (data) {
      data.map(function(obj, key){
        if (obj.type == "Shop"){
          let tmpl = `<option value="${obj.id}">${obj.link}</option>`;
          $('#category').append(tmpl);
        }
      });
    }
  });

  // function getCategoryNew(idParentCategory){
  //   $.ajax({
  //     type: "GET",
  //     beforeSend: function(request) {
  //       request.setRequestHeader("Authorization", 'Token ' + localStorage.getItem('token'));
  //     },
  //     url: '/api/shop/backend/category/?id=' + idParentCategory,
  //     dataType: "json",
  //     success: function (data) {
  //       data.results.map(function(obj, key){
  //         let tmpl = `<option value="${obj.id}">${obj.name}</option>`;
  //         $('#category_new').append(tmpl);
  //       });
  //     }
  //   });
  // }

  // $('#category').on('change', function() {
  //   $('#category_new').html('');
  //   getCategoryNew(this.value);
  // })

  // Create data Brand
  $.ajax({
    type: "GET",
    beforeSend: function(request) {
      request.setRequestHeader("Authorization", 'Token ' + localStorage.getItem('token'));
    },
    url: '/api/brands/',
    dataType: "json",
    success: function (data) {
      data.map(function(obj, key){
        let tmpl = `<option value="${obj.id}">${obj.name}</option>`;
        $('#brand').append(tmpl);
      });
    }
  });

  // Clear all
  // $('#clear-button').click(function(){
  //   $('.variation-row').each(function () {
  //     let obj = {};
  //     $(this).find("input[name]").each(function (index, node) {
  //       obj[node.name] = node.value;
  //     });
  //   });
  // });

  //// Product Variations ////
  var colors = [];
  var sizes = [];
  // Colors
  $('#colors-info input[type=checkbox]').on('change', function(){
    if (checkUnique_id()){
      colors = [];
      $('#colors-info input[type=checkbox]').each(function () {
        if (this.checked){
          colors.push($(this).val());
        }
      });
      scCombination();
    }
  });  
  // Sizes
  $('.tab-content input[type=checkbox]').on('change', function(){
    if (checkUnique_id()){
      sizes = [];
      $('.tab-content input[type=checkbox]').each(function () {
        if (this.checked){
          sizes.push($(this).val());
        }
      });
      scCombination();
    }
  });

  ////////////// Check unique_id //////////////// 
  var check_unique_id = false;
  function removeAllCheck_uniqueId(){
    if (check_unique_id){
      return true;
    } else {
      alert('Unique Id must unique!');
      $('#unique_id_lvnt').addClass('error');
      $('input[name^="unique_id"]').focus();
      $('input:checkbox').removeAttr('checked');
      return false;
    }
  }

  function checkUnique_id(){
    if ($('input[name^="unique_id"]').val()){
      return removeAllCheck_uniqueId();
    } else {
      $('input:checkbox').removeAttr('checked');
      alert('Please add Unique Id first!');
      $('input[name^="unique_id"]').focus();
      return false;
    }
  }

  $('input[name^="unique_id"]').on('keyup', function(){
    let unique_id_value = $('input[name^="unique_id"]').val();
    // Kiem tra => check_unique_id
    let fd = {};
    fd['unique_id'] = unique_id_value;
    $.ajax({
      type: "POST",
      beforeSend: function(request) {
        request.setRequestHeader("Authorization", 'Token ' + localStorage.getItem('token'));
      },
      url: '/api/shop/product/check/unique/',
      data: fd,       
      dataType: "json",
      success: function (data) {  
        if (data == 1){
          check_unique_id = true;
          $('#unique_id_lvnt').removeClass('error');
          $('#unique_id_lvnt .add-on').html('✔');
        } else {
          check_unique_id = false;
          $('#unique_id_lvnt').addClass('error');
          $('#unique_id_lvnt .add-on').html('×');
        }
        // console.log(check_unique_id);
      },
      error: function(jqXHR, text, error){
      }
    });
  });

  // Combination Sizes and Colors
  function scCombination(){
    var combos = [];
    if (colors.length == 0){
      combos = sizes;
      gProVariations(combos, 'sizes');
    } else if (sizes.length == 0){
      combos = colors;
      gProVariations(combos, 'colors');
    } else {
      colors.forEach(function(c){
        sizes.forEach(function(s){
          combos.push(c + ':' + s);
        });
      });
      gProVariations(combos);
    }
  }
  // Genarate html Product Variations
  function gProVariations(combos, condition){
    $('#variations-section .variation-row').remove();
    if (combos.length){
      // $('input[name^="unique_id"]').prop('disabled', true);
      combos.map(function(combo){
        let checkColor = true;
        let color = '';
        let size = '';
        let style = '';
        if (condition == 'sizes'){
          size = combo;
          checkColor = false;
        } else if (condition == 'colors'){
          color = combo;
        } else {
          let obj = combo.split(":");
          color = obj[0];
          size = obj[1];
        }
        if (checkColor){
          style = 'style="background-color: ' + color + '"';
          if (color == 'Multicolor'){
            style = 'style="background-image: url('+'https://main.cdn.merchant.wish.com/c9971081a477/img/multicolor.png'+');background-size: 20px 12px;"';
          }
          // Fix color =))
          if (color == 'Green'){
            style = 'style="background-color: ' + '#00FF00' + '"';
          }
          if (color == 'NavyBlue'){
            style = 'style="background-color: ' + '#000080' + '"';
          }
          style = '<div class="color-box" ' + style + '> </div>';
        }
        // gen HTML
        $('#variations-heading').css('display','block');
        let price_default = $('input[name^="buying_price"]').val()
        let quality_default = $('input[name^="orders_count"]').val()
        let earning_default = (parseInt($('input[name^="buying_price"]').val()) + parseInt($('input[name^="shipping_cost"]').val()))*0.8;
        let unique_id_value = $('input[name^="unique_id"]').val();
        let lvnt = `
          <div class="variation-row earnings-section" name="${size}${color}">
            <div class="variation-inputs"> <span name="size-label" class="variation-name-label">${size}</span> </div>
            <div class="variation-inputs">
              <span name="color-label" class="variation-name-label">
                ${style} ${color}
              </span>
            </div>
            <input type="hidden" name="size" value="${size}">
            <input type="hidden" name="color" value="${color}">      
            <div class="control-group">
              <div class="controls input-append input-large"> <input class="input-block-level required" name="unique_id" id="unique_id_HoangTN" type="text" value="${unique_id_value}_${size}_${color}">
              </div>
            </div>
            <div class="control-group">
              <div class="controls input-append input-small"> <input class="input-block-level required" name="buying_price" id="price__lvnt" type="text" value="${price_default}" placeholder="1200"> <span class="add-on"><i class="icon-pencil"></i></span> </div>
            </div>
            <div class="control-group">
              <div class="controls input-append input-small"> <input class="input-block-level required" name="quantity" type="text" value="${quality_default}" placeholder="1200"> <span class="add-on"><i class="icon-pencil"></i></span> </div>
            </div>
            <div class="control-group">
              <div class="controls input-append input-small">
                <input class="input-block-level" type="text" name="earnings" id="earnings__lvnt" disabled="" value="${earning_default}">
              </div>
            </div>
          </div>
        `;
        $('#variations-section').append(lvnt);
      });
    } else {
      $('#variations-heading').css('display','none');
      $('input[name^="unique_id"]').prop('disabled', false);
    }
  }

  //// Calculate Earning ////
  $('input[name^="buying_price"]').on('keyup', function(){
    calculateEarning();
  });

  $('input[name^="shipping_cost"]').on('keyup', function(){
    calculateEarning();
  });

  function calculateEarning(){
    if ($('input[name^="buying_price"]').val() && $('input[name^="shipping_cost"]').val()){
      let earning = (parseInt($('input[name^="buying_price"]').val()) + parseInt($('input[name^="shipping_cost"]').val()))*0.8;
      $('#earnings').val(parseFloat(earning).toFixed(2));
    } else {
      $('#earnings').val('');
    }
  }

  $('#variations-section').on('keyup', '#price__lvnt', function(){
    let earning_button = $(this).parent().parent().next().next().find("input");
    if ($(this).val()){
      let earning = (parseInt($(this).val())+ parseInt($('input[name^="shipping_cost"]').val()))*0.8;
      $(earning_button).val(parseFloat(earning).toFixed(2));
    } else {
      $(earning_button).val('');
    }
  });
  
  // Form Data
  var formData = new FormData();

  // Add image
  $('#input-4').on('change', function(event) {
    console.log($('#input-4'));
    if ($('#input-4')[0].files[0]){
      formData.append('photos', $('#input-4')[0].files[0]);
    }
  });

  $('#input-4').on("filebatchselected", function(event, files) {
    // console.log(files[0])
    formData.append('photos', files[0]);
  });

  $('#input-5').on('change', function(event) {
    $.each($('#input-5')[0].files, function(i, file) {
      formData.append('photos', file);
    });
    console.log(formData);
  });

    $('#input-5').on("filebatchselected", function(event, files) {
      for (i=0;i<files.length;i++){
        console.log(files[i]);
        formData.append('photos', files[i]);
      }

    });
  // Clear image
  $('#input-5').on('fileclear', function(event) {
    formData = new FormData();
  });

  //// Button Submit ////
  $("#submit-button").click(function() {

    // Check before submit
    $('.control-group').removeClass('error');
    $('input#unique_id_HoangTN').each(function () {
      if (!$(this).val()){
        $(this).parent().parent().addClass('error');
      }
    });

    if (!$('input[name^="title"]').val()){
      $('#summary-action .control-group:eq(0)').html('<div id="summary-error" class="alert alert-error"> You are missing the product name. </div>');
      $('input[name^="title"]').focus();
    } else
    if (!$('textarea[name^="description"]').val()){
      $('#summary-action .control-group:eq(0)').html('<div id="summary-error" class="alert alert-error"> You are missing the Description. </div>');
      $('textarea[name^="description"]').focus();
    } else
    if (!$('input[name^="unique_id"]').val()){
      $('#summary-action .control-group:eq(0)').html('<div id="summary-error" class="alert alert-error"> You are missing the Unique Id. </div>');
      $('input[name^="unique_id"]').focus();
    } else
    if (!check_unique_id){
      removeAllCheck_uniqueId();
    } else
    if (!$('input[name^="buying_price"]').val()){
      $('#summary-action .control-group:eq(0)').html('<div id="summary-error" class="alert alert-error"> You are missing the Price. </div>');
      $('input[name^="buying_price"]').focus();
    } else
    if (!$('input[name^="orders_count"]').val()){
      $('#summary-action .control-group:eq(0)').html('<div id="summary-error" class="alert alert-error"> You are missing the Quantity. </div>');
      $('input[name^="orders_count"]').focus();
    } else
    if (!$('input[name^="shipping_cost"]').val()){
      $('#summary-action .control-group:eq(0)').html('<div id="summary-error" class="alert alert-error"> You are missing the Shipping. </div>');
      $('input[name^="shipping_cost"]').focus();
    } else
    if (!formData.has('photos')){
      $('#summary-action .control-group:eq(0)').html('<div id="summary-error" class="alert alert-error"> Please add main picture! </div>');
      $('#input-4').focus();
    } else {

      // formData.append('photos', $('#input-4')[0].files[0]);
      $('#summary-error').remove();

      var checkVariation = true;
      // From product varidations
      $('.variation-row').each(function () {
        let obj = {};
        $(this).find("input[name]").each(function (index, node) {
          obj[node.name] = node.value;
        });
        formData.append('uniques', JSON.stringify(obj));
        checkVariation = false;
      });

      if (checkVariation) {
        let obj = {};
        obj['unique_id'] = $('input[name^="unique_id"]').val();
        obj['buying_price'] = $('input[name^="buying_price"]').val();
        obj['quantity'] = $('input[name^="orders_count"]').val();
        obj['shipping_cost'] = $('input[name^="shipping_cost"]').val();
        obj['size'] = '';
        obj['color'] = '';
        formData.append('uniques', JSON.stringify(obj));
      }

      if (!$('input#unique_id_HoangTN').val() && !checkVariation){
        $('#summary-action .control-group:eq(0)').html('<div id="summary-error" class="alert alert-error"> You are missing the unique id. </div>');
        $('input#unique_id_HoangTN').css('border','1px solid red')
      } else {

      

      // Data
      // Default value
      formData.append('reward_tokens', 0);
      // Value
      formData.append('title', $('input[name^="title"]').val());
      formData.append('description', $('textarea[name^="description"]').val());
      formData.append('tags', $('input[name^="tags"]').val());
      formData.append('unique_id', $('input[name^="unique_id"]').val());
      formData.append('category', $('#category').val()?$('#category').val():'');
      formData.append('brand', $('#brand').val()?$('#brand').val():'');
      formData.append('buying_price', $('input[name^="buying_price"]').val());
      formData.append('retail_price', $('input[name^="buying_price"]').val()*1.5);
      formData.append('orders_count', $('input[name^="orders_count"]').val());
      formData.append('shipping_cost', $('input[name^="shipping_cost"]').val());
      formData.append('shipping_time', $('input[name^="ship-time-checkbox"]:checked').val());

      // Colors
      $('#colors-info input[type=checkbox]').each(function () {
        if (this.checked){
          formData.append('colors', $(this).val());
        }
      });

      // Sizes
      $('.tab-content input[type=checkbox]').each(function () {
        if (this.checked){
          formData.append('sizes', $(this).val());
        }
      });

      
        $('#submit-button').css('display', 'none');
        $('.loading').css('display','block');

        $.ajax({
          type: "POST",
          beforeSend: function(request) {
            request.setRequestHeader("Authorization", 'Token ' + localStorage.getItem('token'));
          },
          url: '/api/shop/product/create/',
          data: formData,       
          processData: false,  // tell jQuery not to process the data
          contentType: false,  // tell jQuery not to set contentType
          dataType: "json",
          success: function (data) {  
            formData = new FormData();
            $(location).attr('href', '{% url "product" %}');
            
          },
          error: function(jqXHR, text, error){
            formData = new FormData();
            $('#submit-button').css('display', 'inline-block');
            $('.loading').css('display','none')
            if(jqXHR.responseJSON.detail == "UNIQUE_ID_EXISTS"){
              alert('Unique Id Exists');
            } else {
              alert('Error - Fill in all the fields');
            }
            return false;
          }
        });     
      return false;
    }

    }

  });

});
</script>
{% endblock %}