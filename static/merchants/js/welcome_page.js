(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var property=function(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!="number"||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object")return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this);
define('backbone',["underscore"],function(_){var root=this;var previousBackbone=root.Backbone;var slice=Array.prototype.slice;var splice=Array.prototype.splice;var Backbone;if(typeof exports!=="undefined"){Backbone=exports}else{Backbone=root.Backbone={}}Backbone.VERSION="0.9.2";Backbone.setDomLibrary=function(lib){$=lib};Backbone.noConflict=function(){root.Backbone=previousBackbone;return Backbone};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var eventSplitter=/\s+/;var Events=Backbone.Events={on:function(events,callback,context){var calls,event,node,tail,list;if(!callback)return this;events=events.split(eventSplitter);calls=this._callbacks||(this._callbacks={});while(event=events.shift()){list=calls[event];node=list?list.tail:{};node.next=tail={};node.context=context;node.callback=callback;calls[event]={tail:tail,next:list?list.next:node}}return this},off:function(events,callback,context){var event,calls,node,tail,cb,ctx;if(!(calls=this._callbacks))return;if(!(events||callback||context)){delete this._callbacks;return this}events=events?events.split(eventSplitter):_.keys(calls);while(event=events.shift()){node=calls[event];delete calls[event];if(!node||!(callback||context))continue;tail=node.tail;while((node=node.next)!==tail){cb=node.callback;ctx=node.context;if(callback&&cb!==callback||context&&ctx!==context){this.on(event,cb,ctx)}}}return this},trigger:function(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks))return this;all=calls.all;events=events.split(eventSplitter);rest=slice.call(arguments,1);while(event=events.shift()){if(node=calls[event]){tail=node.tail;while((node=node.next)!==tail){node.callback.apply(node.context||this,rest)}}if(node=all){tail=node.tail;args=[event].concat(rest);while((node=node.next)!==tail){node.callback.apply(node.context||this,args)}}}return this}};Events.bind=Events.on;Events.unbind=Events.off;var Model=Backbone.Model=function(attributes,options){var defaults;attributes||(attributes={});if(options&&options.parse)attributes=this.parse(attributes);if(defaults=getValue(this,"defaults")){attributes=_.extend({},defaults,attributes)}if(options&&options.collection)this.collection=options.collection;this.attributes={};this._escapedAttributes={};this.cid=_.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(attributes,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=_.clone(this.attributes);this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},get:function(attr){return this.attributes[attr]},escape:function(attr){var html;if(html=this._escapedAttributes[attr])return html;var val=this.get(attr);return this._escapedAttributes[attr]=_.escape(val==null?"":""+val)},has:function(attr){return this.get(attr)!=null},set:function(key,value,options){var attrs,attr,val;if(_.isObject(key)||key==null){attrs=key;options=value}else{attrs={};attrs[key]=value}options||(options={});if(!attrs)return this;if(attrs instanceof Model)attrs=attrs.attributes;if(options.unset)for(attr in attrs)attrs[attr]=void 0;if(!this._validate(attrs,options))return false;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];var changes=options.changes={};var now=this.attributes;var escaped=this._escapedAttributes;var prev=this._previousAttributes||{};for(attr in attrs){val=attrs[attr];if(!_.isEqual(now[attr],val)||options.unset&&_.has(now,attr)){delete escaped[attr];(options.silent?this._silent:changes)[attr]=true}options.unset?delete now[attr]:now[attr]=val;if(!_.isEqual(prev[attr],val)||_.has(now,attr)!=_.has(prev,attr)){this.changed[attr]=val;if(!options.silent)this._pending[attr]=true}else{delete this.changed[attr];delete this._pending[attr]}}if(!options.silent)this.change(options);return this},unset:function(attr,options){(options||(options={})).unset=true;return this.set(attr,null,options)},clear:function(options){(options||(options={})).unset=true;return this.set(_.clone(this.attributes),options)},fetch:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;options.success=function(resp,status,xhr){if(!model.set(model.parse(resp,xhr),options))return false;if(success)success(model,resp)};options.error=Backbone.wrapError(options.error,model,options);return(this.sync||Backbone.sync).call(this,"read",this,options)},save:function(key,value,options){var attrs,current;if(_.isObject(key)||key==null){attrs=key;options=value}else{attrs={};attrs[key]=value}options=options?_.clone(options):{};if(options.wait){if(!this._validate(attrs,options))return false;current=_.clone(this.attributes)}var silentOptions=_.extend({},options,{silent:true});if(attrs&&!this.set(attrs,options.wait?silentOptions:options)){return false}var model=this;var success=options.success;options.success=function(resp,status,xhr){var serverAttrs=model.parse(resp,xhr);if(options.wait){delete options.wait;serverAttrs=_.extend(attrs||{},serverAttrs)}if(!model.set(serverAttrs,options))return false;if(success){success(model,resp)}else{model.trigger("sync",model,resp,options)}};options.error=Backbone.wrapError(options.error,model,options);var method=this.isNew()?"create":"update";var xhr=(this.sync||Backbone.sync).call(this,method,this,options);if(options.wait)this.set(current,silentOptions);return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var triggerDestroy=function(){model.trigger("destroy",model,model.collection,options)};if(this.isNew()){triggerDestroy();return false}options.success=function(resp){if(options.wait)triggerDestroy();if(success){success(model,resp)}else{model.trigger("sync",model,resp,options)}};options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,"delete",this,options);if(!options.wait)triggerDestroy();return xhr},url:function(){var base=getValue(this,"urlRoot")||getValue(this.collection,"url")||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(resp,xhr){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(options){options||(options={});var changing=this._changing;this._changing=true;for(var attr in this._silent)this._pending[attr]=true;var changes=_.extend({},options.changes,this._silent);this._silent={};for(var attr in changes){this.trigger("change:"+attr,this,this.get(attr),options)}if(changing)return this;while(!_.isEmpty(this._pending)){this._pending={};this.trigger("change",this,options);for(var attr in this.changed){if(this._pending[attr]||this._silent[attr])continue;delete this.changed[attr]}this._previousAttributes=_.clone(this.attributes)}this._changing=false;return this},hasChanged:function(attr){if(!arguments.length)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false,old=this._previousAttributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){if(!arguments.length||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(attrs,options){if(options.silent||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validate(attrs,options);if(!error)return true;if(options&&options.error){options.error(this,error,options)}else{this.trigger("error",this,error,options)}return false}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,{silent:true,parse:options.parse})};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},add:function(models,options){var i,index,length,model,cid,id,cids={},ids={},dups=[];options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,length=models.length;i<length;i++){if(!(model=models[i]=this._prepareModel(models[i],options))){throw new Error("Can't add an invalid model to a collection")}cid=model.cid;id=model.id;if(cids[cid]||this._byCid[cid]||id!=null&&(ids[id]||this._byId[id])){dups.push(i);continue}cids[cid]=ids[id]=model}i=dups.length;while(i--){models.splice(dups[i],1)}for(i=0,length=models.length;i<length;i++){(model=models[i]).on("all",this._onModelEvent,this);this._byCid[model.cid]=model;if(model.id!=null)this._byId[model.id]=model}this.length+=length;index=options.at!=null?options.at:this.models.length;splice.apply(this.models,[index,0].concat(models));if(this.comparator)this.sort({silent:true});if(options.silent)return this;for(i=0,length=this.models.length;i<length;i++){if(!cids[(model=this.models[i]).cid])continue;options.index=i;model.trigger("add",model,this,options)}return this},remove:function(models,options){var i,l,index,model;options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,l=models.length;i<l;i++){model=this.getByCid(models[i])||this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byCid[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model)}return this},push:function(model,options){model=this._prepareModel(model,options);this.add(model,options);return model},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model},shift:function(options){var model=this.at(0);this.remove(model,options);return model},get:function(id){if(id==null)return void 0;return this._byId[id.id!=null?id.id:id]},getByCid:function(cid){return cid&&this._byCid[cid.cid||cid]},at:function(index){return this.models[index]},where:function(attrs){if(_.isEmpty(attrs))return[];return this.filter(function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false}return true})},sort:function(options){options||(options={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var boundComparator=_.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(boundComparator)}else{this.models.sort(boundComparator)}if(!options.silent)this.trigger("reset",this,options);return this},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr)})},reset:function(models,options){models||(models=[]);options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i])}this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return this},fetch:function(options){options=options?_.clone(options):{};if(options.parse===undefined)options.parse=true;var collection=this;var success=options.success;options.success=function(resp,status,xhr){collection[options.add?"add":"reset"](collection.parse(resp,xhr),options);if(success)success(collection,resp)};options.error=Backbone.wrapError(options.error,collection,options);return(this.sync||Backbone.sync).call(this,"read",this,options)},create:function(model,options){var coll=this;options=options?_.clone(options):{};model=this._prepareModel(model,options);if(!model)return false;if(!options.wait)coll.add(model,options);var success=options.success;options.success=function(nextModel,resp,xhr){if(options.wait)coll.add(nextModel,options);if(success){success(nextModel,resp)}else{nextModel.trigger("sync",model,resp,options)}};model.save(null,options);return model},parse:function(resp,xhr){return resp},chain:function(){return _(this.models).chain()},_reset:function(options){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(model,options){options||(options={});if(!(model instanceof Model)){var attrs=model;options.collection=this;model=new this.model(attrs,options);if(!model._validate(model.attributes,options))model=false}else if(!model.collection){model.collection=this}return model},_removeReference:function(model){if(this==model.collection){delete model.collection}model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event=="add"||event=="remove")&&collection!=this)return;if(event=="destroy"){this.remove(model,options)}if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];this._byId[model.id]=model}this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];_.each(methods,function(method){Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)))}});var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var namedParam=/:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){Backbone.history||(Backbone.history=new History);if(!_.isRegExp(route))route=this._routeToRegExp(route);if(!callback)callback=this[name];Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);callback&&callback.apply(this,args);this.trigger.apply(this,["route:"+name].concat(args));Backbone.history.trigger("route",this,name,args)},this));return this},navigate:function(fragment,options){Backbone.history.navigate(fragment,options)},_bindRoutes:function(){if(!this.routes)return;var routes=[];for(var route in this.routes){routes.unshift([route,this.routes[route]])}for(var i=0,l=routes.length;i<l;i++){this.route(routes[i][0],routes[i][1],this[routes[i][1]])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(namedParam,"([^/]+)").replace(splatParam,"(.*?)");return new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1)}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl")};var routeStripper=/^[#\/]/;var isExplorer=/msie [\w.]+/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(windowOverride){var loc=windowOverride?windowOverride.location:window.location;var match=loc.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||forcePushState){fragment=window.location.pathname;var search=window.location.search;if(search)fragment+=search}else{fragment=this.getHash()}}if(!fragment.indexOf(this.options.root))fragment=fragment.substr(this.options.root.length);return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:"/"},this.options,options);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);if(oldIE){this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState){$(window).bind("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!oldIE){$(window).bind("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=fragment;var loc=window.location;var atRoot=loc.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");window.history.replaceState({},document.title,loc.protocol+"//"+loc.host+this.options.root+this.fragment)}if(!this.options.silent){return this.loadUrl()}},stop:function(){$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current==this.fragment&&this.iframe)current=this.getFragment(this.getHash(this.iframe));if(current==this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}});return matched},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};var frag=(fragment||"").replace(routeStripper,"");if(this.fragment==frag)return;if(this._hasPushState){if(frag.indexOf(this.options.root)!=0)frag=this.options.root+frag;this.fragment=frag;window.history[options.replace?"replaceState":"pushState"]({},document.title,frag)}else if(this._wantsHashChange){this.fragment=frag;this._updateHash(window.location,frag,options.replace);if(this.iframe&&frag!=this.getFragment(this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,frag,options.replace)}}else{window.location.assign(this.options.root+fragment)}if(options.trigger)this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){location.replace(location.toString().replace(/(javascript:|#).*$/,"")+"#"+fragment)}else{location.hash=fragment}}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(tagName,attributes,content){var el=document.createElement(tagName);if(attributes)$(el).attr(attributes);if(content!=null)$(el).html(content);return el},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof $?element:$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this},delegateEvents:function(events){if(!(events||(events=getValue(this,"events"))))return;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)throw new Error('Method "'+events[key]+'" does not exist');var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===""){this.$el.bind(eventName,method)}else{this.$el.delegate(selector,eventName,method)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(options){if(this.options)options=_.extend({},this.options,options);for(var i=0,l=viewOptions.length;i<l;i++){var attr=viewOptions[i];if(options[attr])this[attr]=options[attr]}this.options=options},_ensureElement:function(){if(!this.el){var attrs=getValue(this,"attributes")||{};if(this.id)attrs.id=this.id;if(this.className)attrs["class"]=this.className;this.setElement(this.make(this.tagName,attrs),false)}else{this.setElement(this.el,false)}}});var extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child};Model.extend=Collection.extend=Router.extend=View.extend=extend;var methodMap={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};Backbone.sync=function(method,model,options){var type=methodMap[method];options||(options={});var params={type:type,dataType:"json"};if(!options.url){params.url=getValue(model,"url")||urlError()}if(!options.data&&model&&(method=="create"||method=="update")){params.contentType="application/json";params.data=JSON.stringify(model.toJSON())}if(Backbone.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(Backbone.emulateHTTP){if(type==="PUT"||type==="DELETE"){if(Backbone.emulateJSON)params.data._method=type;params.type="POST";params.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type)}}}if(params.type!=="GET"&&!Backbone.emulateJSON){params.processData=false}return $.ajax(_.extend(params,options))};Backbone.wrapError=function(onError,originalModel,options){return function(model,resp){resp=model===originalModel?resp:model;if(onError){onError(originalModel,resp,options)}else{originalModel.trigger("error",originalModel,resp,options)}}};var ctor=function(){};var inherits=function(parent,protoProps,staticProps){var child;if(protoProps&&protoProps.hasOwnProperty("constructor")){child=protoProps.constructor}else{child=function(){parent.apply(this,arguments)}}_.extend(child,parent);ctor.prototype=parent.prototype;child.prototype=new ctor;if(protoProps)_.extend(child.prototype,protoProps);if(staticProps)_.extend(child,staticProps);child.prototype.constructor=child;child.__super__=parent.prototype;return child};var getValue=function(object,prop){if(!(object&&object[prop]))return null;return _.isFunction(object[prop])?object[prop]():object[prop]};var urlError=function(){throw new Error('A "url" property or function must be specified')};return Backbone});
define('core/url',[],function(){function absURL(path,hostname){var port=location.port;port=port==""||port==80?"":":"+port;if(path.indexOf("/")==0){path=path.substring(1)}if(!hostname){hostname=location.hostname}return location.protocol+"//"+hostname+port+"/"+path}function updateHash(category,value){window.location.hash=category+"="+value}function getURIFragment(name){var regex_string="#"+name+"=([^&#]*)";var regex=new RegExp(regex_string);var result=regex.exec(window.location.hash);if(result==null){return""}else{return decodeURIComponent(result[1])}}function getURLParams(){var queryDict={};location.search.substr(1).split("&").forEach(function(item){key=decodeURIComponent(item.split("=")[0]);val=decodeURIComponent(item.split("=")[1]);queryDict[key]=val});return queryDict}function getURLParam(key){var params=getURLParams();if(key in params){return params[key]}else{return null}}function absExtURL(url){return"http://"+url.replace("http://","")}function wishURL(path){return location.protocol+"//wish.com"+path}function contestImageURL(contest_id,size,sequence_id){if(!size){size="medium"}if(!sequence_id){sequence_id=0}return window.lemmings_url+"/"+contest_id+"-"+sequence_id+"-"+size}function resizedContestImageURL(contest_id,width,height,sequence_id,mode){var url=window.location.protocol;url+="//contestimg.wish.com/api/image/fetch?contest_id=";url+=contest_id;url+="&w=";url+=Math.ceil(width);url+="&h=";url+=Math.ceil(height);if(sequence_id){url+="&s=";url+=sequence_id}if(mode!=null){url+="&m=";url+=mode}return url}return{absURL:absURL,absExtURL:absExtURL,wishURL:wishURL,contestImageURL:contestImageURL,resizedContestImageURL:resizedContestImageURL,getURIFragment:getURIFragment,getURLParams:getURLParams,updateHash:updateHash,getURLParam:getURLParam}});
define('lib/jed',["underscore"],function(_){var Jed=function(options){this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages"};this.options=_.extend({},this.defaults,options);this.textdomain(this.options.domain);if(options.domain&&!this.options.locale_data[this.options.domain]){throw new Error("Text domain set to non-existent domain: `"+domain+"`")}};Jed.context_delimiter=String.fromCharCode(4);function getPluralFormFunc(plural_form_string){return Jed.PF.compile(plural_form_string||"nplurals=2; plural=(n != 1);")}function Chain(key,i18n){this._key=key;this._i18n=i18n}_.extend(Chain.prototype,{onDomain:function(domain){this._domain=domain;return this},withContext:function(context){this._context=context;return this},ifPlural:function(num,pkey){this._val=num;this._pkey=pkey;return this},fetch:function(sArr){if({}.toString.call(sArr)!="[object Array]"){sArr=[].slice.call(arguments)}return(sArr&&sArr.length?Jed.sprintf:function(x){return x})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),sArr)}});_.extend(Jed.prototype,{translate:function(key){return new Chain(key,this)},textdomain:function(domain){if(!domain){return this._textdomain}this._textdomain=domain},gettext:function(key){return this.dcnpgettext.call(this,undef,undef,key)},dgettext:function(domain,key){return this.dcnpgettext.call(this,domain,undef,key)},dcgettext:function(domain,key){return this.dcnpgettext.call(this,domain,undef,key)},ngettext:function(skey,pkey,val){return this.dcnpgettext.call(this,undef,undef,skey,pkey,val)},dngettext:function(domain,skey,pkey,val){return this.dcnpgettext.call(this,domain,undef,skey,pkey,val)},dcngettext:function(domain,skey,pkey,val){return this.dcnpgettext.call(this,domain,undef,skey,pkey,val)},pgettext:function(context,key){return this.dcnpgettext.call(this,undef,context,key)},dpgettext:function(domain,context,key){return this.dcnpgettext.call(this,domain,context,key)},dcpgettext:function(domain,context,key){return this.dcnpgettext.call(this,domain,context,key)},npgettext:function(context,skey,pkey,val){return this.dcnpgettext.call(this,undef,context,skey,pkey,val)},dnpgettext:function(domain,context,skey,pkey,val){return this.dcnpgettext.call(this,domain,context,skey,pkey,val)},dcnpgettext:function(domain,context,singular_key,plural_key,val){plural_key=plural_key||singular_key;domain=domain||this._textdomain;val=typeof val=="undefined"?1:val;var fallback;if(!this.options){fallback=new Jed;return fallback.dcnpgettext.call(fallback,undefined,undefined,singular_key,plural_key,val)}if(!this.options.locale_data){throw new Error("No locale data provided.")}if(!this.options.locale_data[domain]){throw new Error("Domain `"+domain+"` was not found.")}if(!this.options.locale_data[domain][""]){throw new Error("No locale meta information provided.")}if(!singular_key){throw new Error("No translation key found.")}if(typeof val!="number"){try{val=parseInt(val,10)}catch(e){throw new Error("Error parsing the value.")}if(isNaN(val)){throw new Error("The number that was passed in is not a number.")}}var key=context?context+Jed.context_delimiter+singular_key:singular_key,locale_data=this.options.locale_data,dict=locale_data[domain],pluralForms=dict[""].plural_forms||(locale_data.messages||this.defaults.locale_data.messages)[""].plural_forms,val_idx=getPluralFormFunc(pluralForms)(val)+1,val_list,res;if(!dict){throw new Error("No domain named `"+domain+"` could be found.")}val_list=dict[key];if(!val_list||val_idx>=val_list.length){res=[null,singular_key,plural_key];return res[getPluralFormFunc(pluralForms)(val)+1]}res=val_list[val_idx];if(!res){res=[null,singular_key,plural_key];return res[getPluralFormFunc(pluralForms)(val)+1]}return res}});var sprintf=function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}function str_repeat(input,multiplier){for(var output=[];multiplier>0;output[--multiplier]=input){}return output.join("")}var str_format=function(){if(!str_format.cache.hasOwnProperty(arguments[0])){str_format.cache[arguments[0]]=str_format.parse(arguments[0])}return str_format.format.call(null,str_format.cache[arguments[0]],arguments)};str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type="",arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==="string"){output.push(parse_tree[i])}else if(node_type==="array"){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw sprintf('[sprintf] property "%s" does not exist',match[2][k])}arg=arg[match[2][k]]}}else if(match[1]){arg=argv[match[1]]}else{arg=argv[cursor++]}if(/[^s]/.test(match[8])&&get_type(arg)!="number"){throw sprintf("[sprintf] expecting number but found %s",get_type(arg))}if(typeof arg=="undefined"||arg===null){arg=""}switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":arg=parseInt(arg,10);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg=Math.abs(arg);break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase();break}arg=/[def]/.test(match[8])&&match[3]&&arg>=0?"+"+arg:arg;pad_character=match[4]?match[4]=="0"?"0":match[4].charAt(1):" ";pad_length=match[6]-String(arg).length;pad=match[6]?str_repeat(pad_character,pad_length):"";output.push(match[5]?arg+pad:pad+arg)}}return output.join("")};str_format.cache={};str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null){parse_tree.push(match[0])}else if((match=/^\x25{2}/.exec(_fmt))!==null){parse_tree.push("%")}else if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!==""){if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1])}else if((field_match=/^\[(\d+)\]/.exec(replacement_field))!==null){field_list.push(field_match[1])}else{throw"[sprintf] huh?"}}}else{throw"[sprintf] huh?"}match[2]=field_list}else{arg_names|=2}if(arg_names===3){throw"[sprintf] mixing positional and named placeholders is not (yet) supported"}parse_tree.push(match)}else{throw"[sprintf] huh?"}_fmt=_fmt.substring(match[0].length)}return parse_tree};return str_format}();var vsprintf=function(fmt,argv){argv.unshift(fmt);return sprintf.apply(null,argv)};Jed.parse_plural=function(plural_forms,n){plural_forms=plural_forms.replace(/n/g,n);return Jed.parse_expression(plural_forms)};Jed.sprintf=function(fmt,args){if({}.toString.call(args)=="[object Array]"){return vsprintf(fmt,[].slice.call(args))}return sprintf.apply(this,[].slice.call(arguments))};Jed.prototype.sprintf=function(){return Jed.sprintf.apply(this,arguments)};Jed.PF={};Jed.PF.parse=function(p){var plural_str=Jed.PF.extractPluralExpr(p);return Jed.PF.parser.parse.call(Jed.PF.parser,plural_str)};Jed.PF.compile=function(p){function imply(val){return val===true?1:val?val:0}var ast=Jed.PF.parse(p);return function(n){return imply(Jed.PF.interpreter(ast)(n))}};Jed.PF.interpreter=function(ast){return function(n){var res;switch(ast.type){case"GROUP":return Jed.PF.interpreter(ast.expr)(n);case"TERNARY":if(Jed.PF.interpreter(ast.expr)(n)){return Jed.PF.interpreter(ast.truthy)(n)}return Jed.PF.interpreter(ast.falsey)(n);case"OR":return Jed.PF.interpreter(ast.left)(n)||Jed.PF.interpreter(ast.right)(n);case"AND":return Jed.PF.interpreter(ast.left)(n)&&Jed.PF.interpreter(ast.right)(n);case"LT":return Jed.PF.interpreter(ast.left)(n)<Jed.PF.interpreter(ast.right)(n);case"GT":return Jed.PF.interpreter(ast.left)(n)>Jed.PF.interpreter(ast.right)(n);case"LTE":return Jed.PF.interpreter(ast.left)(n)<=Jed.PF.interpreter(ast.right)(n);case"GTE":return Jed.PF.interpreter(ast.left)(n)>=Jed.PF.interpreter(ast.right)(n);case"EQ":return Jed.PF.interpreter(ast.left)(n)==Jed.PF.interpreter(ast.right)(n);case"NEQ":return Jed.PF.interpreter(ast.left)(n)!=Jed.PF.interpreter(ast.right)(n);case"MOD":return Jed.PF.interpreter(ast.left)(n)%Jed.PF.interpreter(ast.right)(n);case"VAR":return n;case"NUM":return ast.val;default:throw new Error("Invalid Token found.")}}};Jed.PF.extractPluralExpr=function(p){p=p.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(!/;\s*$/.test(p)){p=p.concat(";")}var nplurals_re=/nplurals\=(\d+);/,plural_re=/plural\=(.*);/,nplurals_matches=p.match(nplurals_re),res={},plural_matches;if(nplurals_matches.length>1){res.nplurals=nplurals_matches[1]}else{throw new Error("nplurals not found in plural_forms string: "+p)}p=p.replace(nplurals_re,"");plural_matches=p.match(plural_re);if(!(plural_matches&&plural_matches.length>1)){throw new Error("`plural` expression not found: "+p)}return plural_matches[1]};Jed.PF.parser=function(){var parser={trace:function trace(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return{type:"GROUP",expr:$$[$0-1]};break;case 2:this.$={type:"TERNARY",expr:$$[$0-4],truthy:$$[$0-2],falsey:$$[$0]};break;case 3:this.$={type:"OR",left:$$[$0-2],right:$$[$0]};break;case 4:this.$={type:"AND",left:$$[$0-2],right:$$[$0]};break;case 5:this.$={type:"LT",left:$$[$0-2],right:$$[$0]};break;case 6:this.$={type:"LTE",left:$$[$0-2],right:$$[$0]};break;case 7:this.$={type:"GT",left:$$[$0-2],right:$$[$0]};break;case 8:this.$={type:"GTE",left:$$[$0-2],right:$$[$0]};break;case 9:this.$={type:"NEQ",left:$$[$0-2],right:$$[$0]};break;case 10:this.$={type:"EQ",left:$$[$0-2],right:$$[$0]};break;case 11:this.$={type:"MOD",left:$$[$0-2],right:$$[$0]};break;case 12:this.$={type:"GROUP",expr:$$[$0-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(yytext)};break}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function parseError(str,hash){throw new Error(str)},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;if(typeof this.lexer.yylloc=="undefined")this.lexer.yylloc={};var yyloc=this.lexer.yylloc;lstack.push(yyloc);if(typeof this.yy.parseError==="function")this.parseError=this.yy.parseError;function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number"){token=self.symbols_[token]||token}return token}var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state]}else{if(symbol==null)symbol=lex();action=table[state]&&table[state][symbol]}_handle_error:if(typeof action==="undefined"||!action.length||!action[0]){if(!recovering){expected=[];for(p in table[state])if(this.terminals_[p]&&p>2){expected.push("'"+this.terminals_[p]+"'")}var errStr="";if(this.lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+this.terminals_[symbol]+"'"}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'")}this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}if(recovering==3){if(symbol==EOF){throw new Error(errStr||"Parsing halted.")}yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;symbol=lex()}while(1){if(TERROR.toString()in table[state]){break}if(state==0){throw new Error(errStr||"Parsing halted.")}popStack(1);state=stack[stack.length-1]}preErrorSymbol=symbol;symbol=TERROR;state=stack[stack.length-1];action=table[state]&&table[state][TERROR];recovering=3}if(action[0]instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol)}switch(action[0]){case 1:stack.push(symbol);vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0)recovering--}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined"){return r}if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=function(){var lexer={EOF:1,parseError:function parseError(str,hash){if(this.yy.parseError){this.yy.parseError(str,hash)}else{throw new Error(str)}},setInput:function(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.match+=ch;this.matched+=ch;var lines=ch.match(/\n/);if(lines)this.yylineno++;this._input=this._input.slice(1);return ch},unput:function(ch){this._input=ch+this._input;return this},more:function(){this._more=true;return this},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length)}return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done){return this.EOF}if(!this._input)this.done=true;var token,match,col,lines;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){match=this._input.match(this.rules[rules[i]]);if(match){lines=match[0].match(/\n.*/g);if(lines)this.yylineno+=lines.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-1:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,rules[i],this.conditionStack[this.conditionStack.length-1]);if(token)return token;else return}}if(this._input===""){return this.EOF}else{this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function lex(){var r=this.next();if(typeof r!=="undefined"){return r}else{return this.lex()}},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){return this.conditionStack.pop()},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function begin(condition){this.begin(condition)}};lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:break;case 1:return 20;break;case 2:return 19;break;case 3:return 8;break;case 4:return 9;break;case 5:return 6;break;case 6:return 7;break;case 7:return 11;break;case 8:return 13;break;case 9:return 10;break;case 10:return 12;break;case 11:return 14;break;case 12:return 15;break;case 13:return 16;break;case 14:return 17;break;case 15:return 18;break;case 16:return 5;break;case 17:return"INVALID";break}};lexer.rules=[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./];lexer.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:true}};return lexer}();parser.lexer=lexer;return parser}();return{Jed:Jed}});
define('core/i18n',["lib/jed"],function(jed){var Jed=jed.Jed;var locale=window.locale_info["locale"];var jedi18n=undefined;if(window.locale_info["locale_json"]==undefined){jedi18n=new Jed({})}else{jedi18n=new Jed({domain:"wish",locale_data:window.locale_info["locale_json"]})}function _i18n(str){var _args=Array.prototype.slice.apply(arguments);if(typeof str!=="string"){console.log("You passed in '"+str+"' to i18n, did you mean ni18n?")}var result=jedi18n.translate(str).fetch(_args.slice(1));if(locale=="up"){result=result.toUpperCase()}return result}function _ni18n(num,singular,plural){var _args=Array.prototype.slice.apply(arguments);format_args=_args.slice(3);format_args.splice(0,0,_args[0]);var str=jedi18n.translate(singular).ifPlural(num,plural).fetch(format_args);if(locale=="up"){str=str.toUpperCase()}return str}function _ci18n(context,message){context=context.toUpperCase();var _args=Array.prototype.slice.apply(arguments);if(!context){return _i18n(message)}var result=jedi18n.translate(message).withContext(context).fetch(_args.slice(1));if(locale=="up"){result=result.toUpperCase()}return result}function _cni18n(context,num,singular,plural){context=context.toUpperCase();var _args=Array.prototype.slice.apply(arguments);format_args=_args.slice(4);format_args.splice(0,0,_args[1]);if(!context){return _ni18n(num,singular,plural)}var str=jedi18n.translate(singular).ifPlural(num,plural).withContext(context).fetch(format_args);if(locale=="up"){str=str.toUpperCase()}return str}return{i18n:_i18n,ni18n:_ni18n,ci18n:_ci18n,cni18n:_cni18n,sprintf:Jed.sprintf}});
define('core/string_utils',["core/i18n"],function(i18nModule){var i18n=i18nModule.i18n;function formatPhoneNumber(num){num=num.replace(/\D/g,"");if(num.length==10){return num.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}else if(num.length==11){return num.replace(/(\d{1})(\d{3})(\d{3})(\d{4})/,"($1) $2-$3-$4")}else{return num}}function round(num,fixed){if(typeof fixed==="undefined"||!fixed){return Math.round(parseFloat(num))}return parseFloat(num).toFixed(fixed)}function formatPercentage(num,denom,fixed){if(!fixed)fixed=0;var n=parseFloat(num);var d=parseFloat(denom);if(d==0)return"100%";return(n/d*100).toFixed(fixed)+"%"}function newlineToBr(html_string){return html_string.replace(/\n/g,"<br>")}function validatePhoneNumberComponent(type,num){if(type==="phone_number_country"){if(num!=num.replace(/\D/g,"")){return i18n("Phone number cannot contain non-numberic characters.")}if(!(1<=num.length&&num.length<=3)){return i18n("Country code is not the right length")}}else if(type==="phone_number_area"){if(num!=num.replace(/\D/g,"")){return i18n("Phone number cannot contain non-number characters.")}if(!(0<=num.length&&num.length<=3)){return i18n("Area code is not the right length")}}else if(type==="phone_number_number"){if(num.indexOf("x")>=0){example="<br>Ex. + 1 - 234 - 5678910x1234";num=num.split("x");if(num.length!=2){return i18n("Phone numbers with extensions can only have one x.")+example}if(num[1].length==0){return i18n("Extension number missing.")+example}if(num[1]!=num[1].replace(/\D/g,"")){return i18n("Extension cannot contain non-number characters.")+example}return validatePhoneNumberComponent(type,num[0])}else{if(num!=num.replace(/\D/g,"")){return i18n("Phone number cannot contain non-number characters.")}if(!(6<=num.length&&num.length<=11)){return i18n("Phone number is not the right length")}}}else{return"Unhandled exception, please contact support"}return true}function copyTextToClipboard(text){var textArea=document.createElement("textarea");textArea.style.position="fixed";textArea.style.top=0;textArea.style.left=0;textArea.style.width="2em";textArea.style.height="2em";textArea.style.padding=0;textArea.style.border="none";textArea.style.outline="none";textArea.style.boxShadow="none";textArea.style.background="transparent";textArea.value=text;document.body.appendChild(textArea);textArea.select();try{document.execCommand("copy")}catch(err){}document.body.removeChild(textArea)}function cleanPhoneNumber(phone_number){if(phone_number[0]!="+"){phone_number="+"+phone_number}while(phone_number.indexOf("+0")>=0){phone_number="+"+phone_number.substring(2,phone_number.length)}return phone_number}function pluralStr(num,singular,plural){if(num==1){return singular}return plural}function isInt(n){return n%1==0}function addCommas(nStr){nStr+="";x=nStr.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,"$1"+","+"$2")}return x1+x2}function getRatio(numerator,denominator,accuracy,is_percent){var x=parseFloat(numerator);var y=parseFloat(denominator);var to_return=0;if(y!=0&&!isNaN(y)){to_return=x*1/y}if(is_percent==true&&to_return>100){to_return=100}return to_return.toFixed(accuracy)}function checkTimeFromNow(time,diff){var today=new Date;var d=new Date(time.substring(6),time.substring(0,2)-1,time.substring(3,5));d.setDate(d.getDate()+diff);return d<today}function formatCurrencySymbol(currencyCode,symbol){var currencySymbol=symbol;if(currencyCode!="USD"){currencySymbol=currencyCode+" "+symbol}return currencySymbol}function formatCurrency(_n,includeDollar,shouldAddCommas,maxNumber,currencyName){var n=parseFloat(_n);if(isNaN(n)){return _n}if(typeof includeDollar==="undefined"){includeDollar=true}if(typeof shouldAddCommas==="undefined"){shouldAddCommas=true}var addPlus=false;if(maxNumber&&!isNaN(maxNumber)){if(n>maxNumber){n=maxNumber;addPlus=true}}var formatted=n.toFixed(2);if(shouldAddCommas){formatted=addCommas(formatted)}if(includeDollar){formatted="$"+formatted;if(n<0){dollar_sign=formatted.charAt(0);negative_sign=formatted.charAt(1);formatted=negative_sign+dollar_sign+formatted.substring(2)}}if(addPlus){formatted=formatted+"+"}if(currencyName){formatted=formatted+'<span class="currency-subscript">'+currencyName+"</span>"}return formatted}function validateVolume(str){var volume_format=/^(\d+(\.\d+)?)\s*(ml|l|oz\.?|m\^3|cm\^3|gallon|quart|cup|qt\.?|pt\.?|litre|liter|pint|fl\.?\s?oz\.?)s?$/gi;if(str.match(volume_format))return true;return false}function validateLength(str){var length_format_1=/^(\d+(\.\d+)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)$/gi;var length_format_2=/^(\d+(\.\d+)?)\s*(ft.?|feet|\')\s*(\d+(\.\d+)?)\s*(in\.?|inche(es)?|\")$/gi;if(str.match(length_format_1)||str.match(length_format_2))return true;return false}function validateArea(str){var area_format_1=/^(\d+(\.\d+)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)\s*(\*|x|by)\s*(\d+(\.\d*)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)$/gi;var area_format_2=/^(\d+(\.\d+)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)\s*(\*|x|by)\s*(\d+(\.\d*)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)\s*(\*|x|X|by)\s*(\d+(\.\d*)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)$/gi;if(str.match(area_format_1)||str.match(area_format_2))return true;return false}function validateVoltage(str){var voltage_format=/^(\d+(\.\d+)?)\s*v$/gi;if(str.match(voltage_format))return true;return false}function validateWattage(str){var wattage_format=/^(\d+(\.\d+)?)\s*w$/gi;if(str.match(wattage_format))return true;return false}function validateCustom(str){var custom_format=/^[a-zA-Z0-9][\ ]*([a-zA-Z0-9.\-&\'\"\(\)\[\]\/][\ ]*)*$/gi;if(str.match(custom_format)&&str.length<=50)return true;return false}function validateWeight(str){var weight_format=/^(\d+(\.\d+)?)\s*(mg|g|kg|oz\.?|ounce|gram|pound|lb)s?$/gi;if(str.match(weight_format))return true;return false}function validateSize(size_string,valid_size_names){if(_.indexOf(valid_size_names,size_string)!=-1||!isNaN(size_string)){return false}else if(validateWeight(size_string)||validateLength(size_string)||validateVoltage(size_string)||validateArea(size_string)||validateVolume(size_string)||validateWattage(size_string)||validateCustom(size_string)){return false}else{return"Invalid size"}}function validateColor(color_string,valid_color_names){var colors=color_string.toLowerCase().replace(/ /g,"").split("&");if(colors.length>2){return"No more than two colors"}var invalid_colors=_.filter(colors,_.bind(function(color){return _.indexOf(valid_color_names,color)==-1},this));if(invalid_colors.length){return"Invalid color"}return false}function validateShippingTime(time_string){var shipping_times=time_string.split("-");if(shipping_times.length==2){var min_shipping_time=shipping_times[0];var max_shipping_time=shipping_times[1];if(isInt(min_shipping_time)&&isInt(max_shipping_time)){min_shipping_time=parseInt(min_shipping_time);max_shipping_time=parseInt(max_shipping_time);if(min_shipping_time>=2&&max_shipping_time>min_shipping_time){return false}}}return"Invalid shipping time"}function containsChineseCharacter(str){var re=/^.*[\u4E00-\u9FA5].*$/;return re.test(str)}function validateEmail(email){var re=/(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*|^"([\001-\010\013\014\016-\037!#-\[\]-\177]|\\[\001-011\013\014\016-\177])*")@(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,10}\.?$/i;return re.test(email)}function validateURL(url){var re=/^.+\..+\/.+$/;return re.test(url)}function validateMinMaxShipTime(ship_time){if(ship_time%1==0){return false}return"Ship time must be a number"}function validatePrice(price){var re=/^\d{0,3}(\.\d{0,2}){0,1}$/;if(price.match(re)){return false}return"Invalid retail price"}function validateShipping(price){if(!price){return"Price is required"}var re=/^\d{0,3}(\.\d{0,2}){0,1}$/;if(price.match(re)){return false}return"Invalid shipping price"}function validateInventory(inv){if(!inv){return false}var re=/^(0|[1-9]\d*)$/;if(inv.match(re)){return false}return"Invalid inventory"}function escapeCSS(text){return text.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\\\$&")}function is_ascii(text){for(var i=0;i<text.length;i++){if(text.charCodeAt(i)>=128){return false}}return true}function is_latin1(text){for(var i=0;i<text.length;i++){if(text.charCodeAt(i)>=256){return false}}return true}function shortenWithEllipsis(text,length){if(length<=3){return"..."}if(text.length>length){return text.substr(0,length-3)+"..."}return text}function escape(s){var n=s;n=n.replace(/&/g,"&amp;");n=n.replace(/</g,"&lt;");n=n.replace(/>/g,"&gt;");n=n.replace(/"/g,"&quot;");return n}function diffString(o,n){o=o.replace(/\s+$/,"");n=n.replace(/\s+$/,"");var out=diff(o==""?[]:o.split(/\s+/),n==""?[]:n.split(/\s+/));var str="";var oSpace=o.match(/\s+/g);if(oSpace==null){oSpace=["\n"]}else{oSpace.push("\n")}var nSpace=n.match(/\s+/g);if(nSpace==null){nSpace=["\n"]}else{nSpace.push("\n")}if(out.n.length==0){for(var i=0;i<out.o.length;i++){str+="<del>"+escape(out.o[i])+oSpace[i]+"</del>"}}else{if(out.n[0].text==null){for(n=0;n<out.o.length&&out.o[n].text==null;n++){str+="<del>"+escape(out.o[n])+oSpace[n]+"</del>"}}for(var i=0;i<out.n.length;i++){if(out.n[i].text==null){str+="<ins>"+escape(out.n[i])+nSpace[i]+"</ins>"}else{var pre="";for(n=out.n[i].row+1;n<out.o.length&&out.o[n].text==null;n++){pre+="<del>"+escape(out.o[n])+oSpace[n]+"</del>"}str+=" "+out.n[i].text+nSpace[i]+pre}}}return str}function diff(o,n){var ns=new Object;var os=new Object;for(var i=0;i<n.length;i++){if(ns[n[i]]==null||n[i].toLowerCase()=="constructor")ns[n[i]]={rows:new Array,o:null};ns[n[i]].rows.push(i)}for(var i=0;i<o.length;i++){if(os[o[i]]==null||o[i].toLowerCase()=="constructor")os[o[i]]={rows:new Array,n:null};os[o[i]].rows.push(i)}for(var i in ns){if(ns[i].rows.length==1&&typeof os[i]!="undefined"&&os[i].rows.length==1){n[ns[i].rows[0]]={text:n[ns[i].rows[0]],row:os[i].rows[0]};o[os[i].rows[0]]={text:o[os[i].rows[0]],row:ns[i].rows[0]}}}for(var i=0;i<n.length-1;i++){if(n[i].text!=null&&n[i+1].text==null&&n[i].row+1<o.length&&o[n[i].row+1].text==null&&n[i+1]==o[n[i].row+1]){n[i+1]={text:n[i+1],row:n[i].row+1};o[n[i].row+1]={text:o[n[i].row+1],row:i+1}}}for(var i=n.length-1;i>0;i--){if(n[i].text!=null&&n[i-1].text==null&&n[i].row>0&&o[n[i].row-1].text==null&&n[i-1]==o[n[i].row-1]){n[i-1]={text:n[i-1],row:n[i].row-1};o[n[i].row-1]={text:o[n[i].row-1],row:i-1}}}return{o:o,n:n}}return{roundFloat:round,checkTimeFromNow:checkTimeFromNow,getRatio:getRatio,addCommas:addCommas,formatCurrency:formatCurrency,formatCurrencySymbol:formatCurrencySymbol,pluralStr:pluralStr,formatPhoneNumber:formatPhoneNumber,newlineToBr:newlineToBr,validatePhoneNumberComponent:validatePhoneNumberComponent,validateSize:validateSize,validateArea:validateArea,validateColor:validateColor,validateShippingTime:validateShippingTime,validateEmail:validateEmail,validateURL:validateURL,validateMinMaxShipTime:validateMinMaxShipTime,containsChineseCharacter:containsChineseCharacter,cleanPhoneNumber:cleanPhoneNumber,validateVolume:validateVolume,validateWeight:validateWeight,validateLength:validateLength,validateVoltage:validateVoltage,validateWattage:validateWattage,validateCustom:validateCustom,formatPercentage:formatPercentage,validatePrice:validatePrice,validateShipping:validateShipping,validateInventory:validateInventory,escapeCSS:escapeCSS,is_ascii:is_ascii,is_latin1:is_latin1,shortenWithEllipsis:shortenWithEllipsis,diffString:diffString,copyTextToClipboard:copyTextToClipboard}});
define('core/template',["underscore","core/url","core/string_utils","core/i18n"],function(_,url,string,i18nModule){var GlobalTplContext={wishURL:url.wishURL,absURL:url.absURL,absExtURL:url.absExtURL,contestImageURL:url.contestImageURL,resizedContestImageURL:url.resizedContestImageURL,formatCurrency:string.formatCurrency,formatCurrencySymbol:string.formatCurrencySymbol,pluralStr:string.pluralStr,formatPhoneNumber:string.formatPhoneNumber,newlineToBr:string.newlineToBr,addCommas:string.addCommas,getRatio:string.getRatio,checkTimeFromNow:string.checkTimeFromNow,formatPercentage:string.formatPercentage,roundFloat:string.roundFloat,shortenWithEllipsis:string.shortenWithEllipsis,_:_};_.extend(GlobalTplContext,i18nModule);if(typeof window.staticUrl!==undefined){GlobalTplContext["staticUrl"]=window.staticUrl}function buildTemplate(tpl){if(typeof tpl=="string"){tpl=_.template(tpl)}function renderWrapper(data){data=data?data:{};return tpl(_.extend(data,GlobalTplContext))}return renderWrapper}return{buildTemplate:buildTemplate}});
define('lib/jquery.cookie',[],function(){(function($,document,undefined){var pluses=/\+/g;function raw(s){return s}function decoded(s){return decodeURIComponent(s.replace(pluses," "))}var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(value===null){options.expires=-1}if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}value=config.json?JSON.stringify(value):String(value);return document.cookie=[encodeURIComponent(key),"=",config.raw?value:encodeURIComponent(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var decode=config.raw?raw:decoded;var cookies=document.cookie.split("; ");for(var i=0,parts;parts=cookies[i]&&cookies[i].split("=");i++){if(decode(parts.shift())===key){var cookie=decode(parts.join("="));return config.json?JSON.parse(cookie):cookie}}return null};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==null){$.cookie(key,null,options);return true}return false}})(jQuery,document)});
(function(){var progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],tplSplitRegExp=/^\/\/ ([A-Z0-9_]+) \\\\/im,buildMap={},templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g,template=function(text){var matcher=new RegExp([(templateSettings.escape||noMatch).source,(templateSettings.interpolate||noMatch).source,(templateSettings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text=text.replace(/[ \n\t\r]+/g," ");text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});source+=escape?"'+((__t=("+escape+"))==null?'':_.escape(__t))+'":interpolate?"'+((__t=("+interpolate+"))==null?'':__t)+'":evaluate?"';"+evaluate+" __p+='":"";index=offset+match.length});source+="';";source=source.replace(/[ \t]+/g," ");source="with(obj||{}){"+source+"}";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};"+source+"return __p;";return source};define('tpl',[],function(){var tpl;var get,fs;if(typeof window!=="undefined"&&window.navigator&&window.document){get=function(url,callback){var xhr=tpl.createXhr();xhr.open("GET",url,true);xhr.onreadystatechange=function(evt){if(xhr.readyState===4){callback(xhr.responseText)}};xhr.send(null)}}else if(typeof process!=="undefined"&&process.versions&&!!process.versions.node){fs=require.nodeRequire("fs");get=function(url,callback){callback(fs.readFileSync(url,"utf8"))}}return tpl={version:"0.24.0",jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g," ").replace(/[\t]/g," ").replace(/[\r]/g," ")},createXhr:function(){var xhr,i,progId;if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest}else{for(i=0;i<3;i++){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}}if(!xhr){throw new Error("require.getXhr(): XMLHttpRequest not available")}return xhr},get:get,load:function(name,req,onLoad,config){var filePrefix="../../templates/js/";if(config.locale){filePrefix="../../templates/build-js-"+config.locale+"/"}var fileName=filePrefix+name;var url="nameToUrl"in req?req.nameToUrl(fileName,".html"):req.toUrl(fileName+".html");var tplBegin=url.indexOf(filePrefix);url=config.baseUrl+filePrefix+name+".html";if(buildMap.hasOwnProperty(name)){return onLoad(buildMap[name])}tpl.get(url,function(content){subtemplates=content.split(tplSplitRegExp);if(subtemplates[0]==""){subtemplates=subtemplates.slice(1)}content_obj={};for(var i=0;i<subtemplates.length;i+=2){content_obj[subtemplates[i]]=template(subtemplates[i+1])}if(config.isBuild){pieces=[];for(tpl_name in content_obj){if(content_obj.hasOwnProperty(tpl_name)){pieces.push('"'+tpl_name+'"'+":function(obj){"+content_obj[tpl_name]+"}")}}ret_content="return {"+pieces.join(",")+"};"}else{ret_content={};for(tpl_name in content_obj){if(content_obj.hasOwnProperty(tpl_name)){try{ret_content[tpl_name]=new Function("obj",content_obj[tpl_name])}catch(e){console.log("Exception compiling "+tpl_name);console.debug("Template output (beautify & syntax check...):");console.debug(content_obj[tpl_name]);throw e}}}}buildMap[name]=ret_content;onLoad(ret_content)})},write:function(pluginName,moduleName,write){if(moduleName in buildMap){var content=tpl.jsEscape(buildMap[moduleName]);write("define('"+pluginName+"!"+moduleName+"', function() {"+content.replace(/(\\')/g,"'").replace(/(\\\\)/g,"\\")+"});\n")}}};return function(){}})})();

define('tpl!modal', function() {return {"alert_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> <div class="alert alert-'+((__t=(type))==null?'':_.escape(__t))+'"> <strong> '; _.each(message.split('\n'), function(msg) { __p+=' <p>'+((__t=(msg))==null?'':_.escape(__t))+'</p> '; }); __p+=' </strong> </div> </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn btn-primary" id="'+((__t=(type))==null?'':_.escape(__t))+'-btn">OK</a> </div> </div> ';}return __p;},"info_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> '; if (typeof body !== "undefined") { __p+=' '+((__t=(body))==null?'':__t)+' '; } else { __p+=' <div class=""> <strong> '; _.each(message.split('\n'), function(msg) { __p+=' <p>'+((__t=(msg))==null?'':_.escape(__t))+'</p> '; }); __p+=' </strong> </div> '; } __p+=' </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn btn-primary">OK</a> </div> </div> ';}return __p;},"relogin_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade"> <div class="modal-header" style="background: #f1f1f1"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3 style="text-align: center;">'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> <div style="text-align: center; padding: 0px 40px 0px 40px; font-size: 16px; margin-top: 5px;"> <div style="font-size: 14px"> '; _.each(message.split('\n'), function(msg) { __p+=' <p>'+((__t=(msg))==null?'':_.escape(__t))+'</p> '; }); __p+=' </div> <table> <tr> <td valign="middle" style="font-size: 14px; text-align: right; padding-bottom: 10px"> '+((__t=(username_prompt))==null?'':_.escape(__t))+': </td> <td> <input id="username" style="text-align:left; padding: 10px; width: 275px;" type="text" value="'+((__t=(username_txt))==null?'':_.escape(__t))+'" required="true" disabled /> </td> </tr> <tr> <td valign="middle" style="font-size: 14px; text-align: right; padding-bottom: 10px"> '+((__t=(password_prompt))==null?'':_.escape(__t))+': </td> <td> <input id="password" type="password" name="password" style="text-align:left; padding: 10px; width:275px;" required="true" placeholder="'+((__t=(password_txt))==null?'':_.escape(__t))+'" /> </td> </tr> </table> </div> </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn btn-cancel">'+((__t=(cancel_txt))==null?'':_.escape(__t))+'</a> <a class="btn btn-primary" id="relogin-btn" >'+((__t=(relogin_txt))==null?'':_.escape(__t))+'</a> </div> </div> ';}return __p;}};});

define('core/api',["underscore","core/url","lib/jquery.cookie","tpl!modal","core/i18n"],function(_,urlModule,cookie,modals,i18n){var i18n=i18n.i18n;function _handleError(resp,data,xhr,opt,cb,call_data){if(window.debug){if(resp){console.debug("API call error: %s (code %d)",resp.msg,resp.code)}if(data&&data.trace){console.debug(data.trace)}else if(resp.data&&resp.data.trace){console.debug(resp.data.trace)}}if(resp.code==2&&resp.data.session_expired==true){setTimeout(function(){window.location=urlModule.absURL("/login")},3500)}if(resp.code==3&&resp.data.secure_session_expired==true){var uname=resp.data.username;launchReloginModal(uname,call_data)}if(cb){cb(resp,data,xhr,opt)}else{var msg=resp&&resp.msg?resp.msg:i18n("Unknown Error");launchErrorModal(msg)}}function launchErrorModal(message){var modal_el=modals.alert_modal({title:"Error",message:message,type:"error"});var $modal_el=$(modal_el);$modal_el.modal({});$modal_el.on("hidden",function(){$modal_el.remove()});return $modal_el}function launchReloginModal(uname,call_data){var modal_el=modals.relogin_modal({title:i18n("Please Re-enter Your Password"),message:i18n("For your security, you must re-enter your password to continue:"),username_txt:uname,password_txt:i18n("Password"),username_prompt:i18n("Username"),password_prompt:i18n("Re-Enter Password"),relogin_txt:i18n("Submit Password"),cancel_txt:i18n("Cancel")});var $modal_el=$(modal_el);var $pwd_box=$modal_el.find("#password");var $relogin_btn=$modal_el.find("#relogin-btn");var $click_btn=$relogin_btn;$modal_el.on("shown",function(){$pwd_box.focus()});$modal_el.modal({});$relogin_btn.on("click",function(){pwd=$pwd_box.val();if(pwd==""){$err_modal=launchErrorModal(i18n("Please enter your password"));$mb=$modal_el.find(".modal-body");$click_btn=$err_modal.find(".btn");$err_modal.find(".modal-body").css({height:$mb.height(),width:$mb.width()});return}call("relogin",{password:pwd,tfa_required:false},function(){$modal_el.modal("hide");call.apply(this,call_data)},function(){$err_modal=launchErrorModal(i18n("Incorrect Password"));$mb=$modal_el.find(".modal-body");$click_btn=$err_modal.find(".btn");$err_modal.find(".modal-body").css({height:$mb.height(),width:$mb.width()})})});$pwd_box.keypress(function(evt){if(evt.keyCode==13){$click_btn.click();if($click_btn!=$relogin_btn){$click_btn=$relogin_btn}}});$modal_el.on("hidden",function(){$modal_el.remove()})}function launchSuccessModal(message){var modal_el=modals.alert_modal({title:"Success",message:message,type:"success"});var $modal_el=$(modal_el);$modal_el.modal({});$modal_el.on("hidden",function(){$modal_el.remove()});return $modal_el}function launchInfoModal(message,title){var modal_el=modals.info_modal({title:title,message:message});var $modal_el=$(modal_el);$modal_el.modal({});$modal_el.on("hidden",function(){$modal_el.remove()})}var makeOriginalXhr=_.bind($.ajaxSettings.xhr,$.ajaxSettings);var newOptions={};function handleOnProgress(evt,options){if(typeof options.progress==="function"){options.progress(options.__jqXHR,evt)}}newOptions.xhr=function(){var s=this;var newXhr=makeOriginalXhr();if(newXhr){newXhr.addEventListener("progress",function(evt){handleOnProgress(evt,s)})}return newXhr};$.ajaxSetup(newOptions);function call(method,params,callback,errorCallback,data,selector,num_retries){if(window.pageParams.session_expiry_extend_min){if(window.session_expiry){var d=window.session_expiry-(new Date).getTime();if(d<window.pageParams.session_expiry_refresh_ttl_sec*1e3){window.session_expiry=(new Date).getTime()+window.pageParams.session_expiry_extend_min*60*1e3}window.update_session_expiry()}}num_retries=num_retries||0;var url=urlModule.absURL("api/"+method);var args=arguments;_.each(params,function(v,k){if(v==null){delete params[k]}});return makeAjaxCallWithRetry(num_retries,1,url,params,callback,errorCallback,data,args)}var makeAjaxCallWithRetry=function(num_retries,retries,url,params,callback,errorCallback,data,args){return $.ajax({beforeSend:function(xhr,settings){xhr.setRequestHeader("X-XSRFToken",$.cookie("_xsrf"));return true},type:"POST",url:url,dataType:"json",data:params,success:function(o,xhr,opt){o.additional_data=data;if(callback){callback(o,data,xhr,opt)}},error:function(xhr,opt,data){if(opt=="abort"){return}else{try{resp=jQuery.parseJSON(xhr.responseText)}catch(err){if(xhr.status==504||xhr.status==503){if(retries<=num_retries){console.debug("Retrying request attempt number "+retries);setTimeout(function(){makeAjaxCallWithRetry(num_retries,retries+1,url,params,callback,errorCallback,data),Math.pow(1.5,retries)*1e3});return}resp={code:4,msg:"Request Timedout"}}else{resp={code:9,msg:"Unknown Error"}}}_handleError(resp,data,xhr,opt,errorCallback,args)}}})};function CallWithRetry(method,params,callback,errorCallback,data,selector,num_retries){num_retries=num_retries||5;return call(method,params,callback,errorCallback,data,selector,num_retries)}function file(method,params,callback,progressCallback,errorCallback,data,selector){var url=urlModule.absURL("api/"+method);_.each(params,function(v,k){if(v==null){delete params[k]}});return $.ajax({beforeSend:function(xhr,settings){xhr.setRequestHeader("X-XSRFToken",$.cookie("_xsrf"));return true},progress:function(xhr,progressEvent){if(progressCallback){progressCallback(progressEvent)}},type:"POST",url:url,data:params,processData:false,contentType:false,success:function(o,xhr,opt){if(callback){callback(o,data,xhr,opt)}},error:function(xhr,opt,data){if(opt=="abort"){return}else{try{resp=jQuery.parseJSON(xhr.responseText)}catch(err){if(xhr.status==504){resp={code:4,msg:"Request Timedout"}}else{resp={code:9,msg:"Unknown Error"}}}_handleError(resp,data,xhr,opt,errorCallback,arguments)}}})}return{launchSuccessModal:launchSuccessModal,launchErrorModal:launchErrorModal,launchInfoModal:launchInfoModal,call:call,CallWithRetry:CallWithRetry,file:file,_handleError:_handleError}});
define('core/bb',["backbone","core/template","core/api"],function(Backbone,TplModule,api){var BackboneView=Backbone.View.extend({buildTpl:function(tpl){return TplModule.buildTemplate(tpl)}});var BackboneModel=Backbone.Model.extend({readOnlyAttributes:[],sync:function(method,model,_options){var options={};$.extend(true,options,_options);var urlPostfix=method;if(method=="read"){urlPostfix="get"}if(!options.url){options.url=model.urlRoot}options.url+="/"+urlPostfix;var params=model.toJSON();return api.call(options.url,params,options.callback,options.errorCallback,options.data,options.selector)},fetch:function(_options){var options={};$.extend(true,options,_options);var model=this;var callback=options.callback;options.callback=_.bind(function(resp,data,xhr,opt){if(!model.set(model.parse(resp,xhr),options))return false;if(callback)callback(model,resp)},this);return this.sync.call(this,"read",this,options)},save:function(_options){var options={};$.extend(true,options,_options);var model=this;var callback=options.callback;options.callback=_.bind(function(resp,data,xhr,opt){if(!model.set(model.parse(resp,xhr),options))return false;if(callback)callback(model,resp)},this);var method=this.isNew()?"create":"update";return this.sync.call(this,method,this,options)},destroy:function(_options){var options={};$.extend(true,options,_options);var model=this;var triggerDestroy=function(){model.trigger("destroy",model,model.collection,options)};if(this.isNew()){triggerDestroy();return false}var callback=options.callback;options.callback=function(resp){if(options.wait)triggerDestroy();if(callback){callback(model,resp)}else{model.trigger("sync",model,resp,options)}};options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,"delete",this,options);if(!options.wait)triggerDestroy();return xhr},parse:function(resp,xhr){return resp.data},toJSON:function(options){var data={};for(var att in this.attributes){if(!_.contains(this.readOnlyAttributes,att)){if(this.attributes[att]!==null&&typeof this.attributes[att]==="object"){data[att]=JSON.stringify(this.attributes[att])}else{data[att]=this.attributes[att]}}}return data}});var BackboneRouter=Backbone.Router.extend({});var BackboneCollection=Backbone.Collection.extend({});var startHistory=function(){if(Backbone.history){Backbone.history.start()}};return{BackboneView:BackboneView,BackboneModel:BackboneModel,BackboneRouter:BackboneRouter,BackboneCollection:BackboneCollection,startHistory:startHistory}});
define('domReady',[],function(){var isBrowser=typeof window!=="undefined"&&window.document,isPageLoaded=!isBrowser,doc=isBrowser?document:null,readyCalls=[],readyLoaderCalls=[],req=requirejs||require||{},oldResourcesReady=req.resourcesReady,scrollIntervalId;function runCallbacks(callbacks){for(var i=0,callback;callback=callbacks[i];i++){callback(doc)}}function callReady(){var callbacks=readyCalls,loaderCallbacks=readyLoaderCalls;if(isPageLoaded){if(callbacks.length){readyCalls=[];runCallbacks(callbacks)}if(req.resourcesDone&&loaderCallbacks.length){readyLoaderCalls=[];runCallbacks(loaderCallbacks)}}}if("resourcesReady"in req){req.resourcesReady=function(isReady){if(oldResourcesReady){oldResourcesReady(isReady)}if(isReady){callReady()}}}function pageLoaded(){if(!isPageLoaded){isPageLoaded=true;if(scrollIntervalId){clearInterval(scrollIntervalId)}callReady()}}if(isBrowser){if(document.addEventListener){document.addEventListener("DOMContentLoaded",pageLoaded,false);window.addEventListener("load",pageLoaded,false)}else if(window.attachEvent){window.attachEvent("onload",pageLoaded);if(self===self.top){scrollIntervalId=setInterval(function(){try{if(document.body){document.documentElement.doScroll("left");pageLoaded()}}catch(e){}},30)}}if(document.readyState==="complete"){pageLoaded()}}function domReady(callback){if(isPageLoaded){callback(doc)}else{readyCalls.push(callback)}return domReady}domReady.withResources=function(callback){if(isPageLoaded&&req.resourcesDone){callback(doc)}else{readyLoaderCalls.push(callback)}return domReady};domReady.version="1.0.0";domReady.load=function(name,req,onLoad,config){if(config.isBuild){onLoad(null)}else{domReady(onLoad)}};return domReady});

define('tpl!modals/base_modal', function() {return {"base_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade" id="'+((__t=(modal_id))==null?'':_.escape(__t))+'"> <div class="modal-header"> <h3>'+((__t=(modal_header))==null?'':_.escape(__t))+'</h3> </div> <div class=\'modal-body\'></div> <div class="modal-footer"> <a data-dismiss="modal" class="btn">Close</a> </div> </div> ';}return __p;}};});

define('view/modal/BaseModal',["core/bb","tpl!modals/base_modal"],function(bb,modal_tpl){var BaseModalView=bb.BackboneView.extend({setView:function(options){this.view=$(modal_tpl.base_modal({modal_id:options.id,modal_header:options.header}));this.view.find(".modal-body").html(options.body);return this.view},launchModal:function(el,options){var $modal_el=$(el);if(!options)options={};$modal_el.on("hidden",_.bind(function(){this.trigger("hidden")},this));if($(".modal-backdrop")){$modal_el.on("shown",function(e){var $t=$(e.target);if($t.hasClass("modal")){$t2=$t.data("modal");$t2.$backdrop.css("z-index",1047)}}).on("hidden",function(e){var $t=$(e.target);if($t.hasClass("modal")){$("body").addClass("modal-open")}}).on("focusin",function(e){e.stopPropagation()})}$modal_el.modal(options);$modal_el.on("hidden",function(){$modal_el.remove()});this.setElement($modal_el)},apiError:function(resp){this.$(".modal-footer").html("<button "+'class="btn btn-primary" data-dismiss="modal">Ok</button>');this.$(".modal-body").html('<div class="alert alert-error">'+"<strong>"+resp.msg+"</strong>"+"</div>")},apiSuccess:function(msg){this.$(".modal-footer").html("<button "+'class="btn btn-primary" data-dismiss="modal">Ok</button>');this.$(".modal-body").html('<div class="alert alert-success"><strong>'+msg+"</strong></div>")},closeModal:function(){$(this.el).modal("hide")}});return BaseModalView});

define('tpl!modals/onboarding_checklist', function() {return {"modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div id="onboarding-checklist-modal" class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(modal_title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> </div> <div class="modal-footer"> <a class="btn btn-primary" href="'+((__t=(absURL('/')))==null?'':_.escape(__t))+'">'+((__t=(i18n("Return Home")))==null?'':_.escape(__t))+'</a> <button data-dismiss="modal" type="button" class="btn">'+((__t=(i18n("Close")))==null?'':_.escape(__t))+'</button> </div> </div> ';}return __p;}};});


define('tpl!new_onboarding', function() {return {"contact_info":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="onboarding-form"> <div class="title"> '+((__t=(i18n("Add your contact information")))==null?'':_.escape(__t))+' </div> <form> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="first_name">'+((__t=(i18n("First Name")))==null?'':_.escape(__t))+'</label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.first_name))==null?'':_.escape(__t))+'" id="first_name" placeholder="'+((__t=(i18n("First Name")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="span6 control-group"> <label class="control-label" for="last_name">'+((__t=(i18n("Last Name")))==null?'':_.escape(__t))+'</label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.last_name))==null?'':_.escape(__t))+'" id="last_name" placeholder="'+((__t=(i18n("Last Name")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="street_address1"> '+((__t=(i18n("Street Address")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.street_address1))==null?'':_.escape(__t))+'" id="street_address1" placeholder="'+((__t=(i18n("Street Address")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.street_address2))==null?'':_.escape(__t))+'" id="street_address2" placeholder="'+((__t=(i18n("Street Address 2 (optional)")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="country_code"> '+((__t=(i18n("Country")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <select id="country_code" class="form-control" required> <option value>'+((__t=(i18n("Choose One")))==null?'':_.escape(__t))+'</option> '; _.each(countries, function(country) { __p+=' '; var code = country[0]; __p+=' '; var name = code == "GB" ? "United Kingdom" : country[1]; __p+=' <option '+((__t=(code == fields.country_code ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(code))==null?'':_.escape(__t))+'">'+((__t=(name))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="span6 control-group"> <label class="control-label" for="state"> '+((__t=(i18n("State")))==null?'':_.escape(__t))+' </label> <div id="state-container" class="controls input-append"> </div> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="city"> '+((__t=(i18n("City")))==null?'':_.escape(__t))+' </label> <div id="city-container" class="controls input-append"> </div> </div> <div class="span6 control-group"> <label class="control-label" for="zipcode"> '+((__t=(i18n("Zipcode/Postal Code")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.zipcode))==null?'':_.escape(__t))+'" id="zipcode" placeholder="'+((__t=(i18n("Zipcode/Postal Code")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="phone_country"> '+((__t=(i18n("Phone Number")))==null?'':_.escape(__t))+' </label> <div class="controls row-fluid"> <div class="span3"> <input type="text" class="form-control phone-component" value="'+((__t=(fields.phone_number_country))==null?'':_.escape(__t))+'" required id="phone_number_country" placeholder="'+((__t=(i18n("Country")))==null?'':_.escape(__t))+'"/> </div> <div class="span3"> <input type="text" class="form-control phone-component" value="'+((__t=(fields.phone_number_area))==null?'':_.escape(__t))+'" required id="phone_number_area" placeholder="'+((__t=(i18n("Area")))==null?'':_.escape(__t))+'"/> </div> <div class="span6 input-append"> <input type="text" class="form-control phone-component" value="'+((__t=(fields.phone_number_number))==null?'':_.escape(__t))+'" required id="phone_number_number" placeholder="'+((__t=(i18n("Number")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="controls row-fluid"> Ex. + 1 - 234 - 5678910 <br/> Ex. + 86 - - 13912345678 <br/> Ex. + 86 - 21 - 65142545 </div> </div> </div> </form> <hr/> <div class="buttons clearfix"> <div class="pull-left"> </div> <div class="pull-right"> <span id="next-btn" class="flat-orange-btn onboarding-btn"> '+((__t=(i18n("Next")))==null?'':_.escape(__t))+' </span> </div> </div> </div> ';}return __p;},"state_input":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' '; if (state_options) { __p+=' <select id="state" class="form-control" required> <option value="">'+((__t=(i18n("Choose One")))==null?'':_.escape(__t))+'</option> '; _.each(state_options, function(state) { __p+=' <option '+((__t=(state == fields.state ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(state))==null?'':_.escape(__t))+'">'+((__t=(state))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> '; } else { __p+=' <input type="text" class="form-control" value="'+((__t=(fields.state))==null?'':_.escape(__t))+'" id="state" placeholder="'+((__t=(i18n("State")))==null?'':_.escape(__t))+'" required '+((__t=(state_options === null ? 'disabled' : ''))==null?'':_.escape(__t))+'/> '; } __p+=' <span class="add-on"><i class="icon icon-pencil"></i></span> ';}return __p;},"city_input":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' '; if (city_options) { __p+=' <select id="city" class="form-control" required> <option value>'+((__t=(i18n("Choose One")))==null?'':_.escape(__t))+'</option> '; _.each(city_options, function(city) { __p+=' <option '+((__t=(city == fields.city ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(city))==null?'':_.escape(__t))+'">'+((__t=(city))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> '; } else { __p+=' <input type="text" class="form-control" value="'+((__t=(fields.city))==null?'':_.escape(__t))+'" id="city" placeholder="'+((__t=(i18n("City")))==null?'':_.escape(__t))+'" required '+((__t=(city_options === null ? 'disabled' : ''))==null?'':_.escape(__t))+'/> '; } __p+=' <span class="add-on"><i class="icon icon-pencil"></i></span> ';}return __p;},"store_info":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="onboarding-form"> <div class="title"> '+((__t=(i18n("Tell us about your store")))==null?'':_.escape(__t))+' </div> <form> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="store_url"> '+((__t=(i18n("What store platform are you currently using?")))==null?'':_.escape(__t))+' </label> <div class="controls input-prepend input-append"> <select id="store_platform" class="form-control add-on" required data-name="'+((__t=(i18n("Current store platform")))==null?'':_.escape(__t))+'"> <option value>'+((__t=(i18n("Choose One")))==null?'':_.escape(__t))+'</option> '; _.each(store_platforms, function(platform) { __p+=' <option '+((__t=(fields.store_platform == platform[0] ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(platform[0]))==null?'':_.escape(__t))+'">'+((__t=(platform[1]))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> <input type="url" id="store_url" data-name="'+((__t=(i18n("URL/Link to store")))==null?'':_.escape(__t))+'" class="form-control" value="'+((__t=(fields.store_url))==null?'':_.escape(__t))+'" '+((__t=(fields.store_platform ? '' : 'disabled'))==null?'':_.escape(__t))+' placeholder="'+((__t=(i18n("URL/Link to store")))==null?'':_.escape(__t))+'" required /> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="annual_gmv"> '+((__t=(i18n("How much revenue did your store make last year? (USD)")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <input type="text" class="form-control" required min="0" step="0.01" value="'+((__t=(fields.annual_gmv))==null?'':_.escape(__t))+'" id="annual_gmv" placeholder="'+((__t=(i18n("Revenue last year (USD)")))==null?'':_.escape(__t))+'" data-name="'+((__t=(i18n("Revenue last year")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="warehouse_location_country"> '+((__t=(i18n("Where is your inventory/warehouse located?")))==null?'':_.escape(__t))+' </label> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <div class="controls input-append"> <select id="warehouse_location_country" data-name="'+((__t=(i18n("Warehouse/Inventory Country")))==null?'':_.escape(__t))+'" class="form-control" required> <option value>'+((__t=(i18n("Choose One")))==null?'':_.escape(__t))+'</option> '; _.each(countries, function(country) { __p+=' '; var code = country[0]; __p+=' '; var name = code == "GB" ? "United Kingdom" : country[1]; __p+=' <option '+((__t=(name == fields.warehouse_location_country ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(name))==null?'':_.escape(__t))+'">'+((__t=(name))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="span6 control-group"> <div class="controls input-append"> <input type="text" data-name="'+((__t=(i18n("Warehouse/Inventory Region")))==null?'':_.escape(__t))+'" class="form-control" value="'+((__t=(fields.warehouse_location_region))==null?'':_.escape(__t))+'" id="warehouse_location_region" placeholder="'+((__t=(i18n("State/Province/Region")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="product_categories"> '+((__t=(i18n("Product Categories")))==null?'':_.escape(__t))+' </label> <div class="row-fluid"> '; var i = 0; __p+=' '; _.each(product_categories, function(text, key) { __p+=' '; if (i % 3 == 0 && i !== 0) { __p+=' </div> <div class="row-fluid"> '; } __p+=' <div class="span4"> <label class="checkbox-label"> <input type="checkbox" name="product_categories" '; if (fields.product_categories[key]) { __p+=' checked '; } __p+=' class="form-control" value="'+((__t=(key))==null?'':_.escape(__t))+'"/> '+((__t=(text))==null?'':_.escape(__t))+' </label> </div> '; i++; __p+=' '; }); __p+=' </div> </div> </div> </form> <div id="bottom-notice"> '+((__t=(i18n("By clicking \"Enter my store\", you agree to")))==null?'':_.escape(__t))+' <a href="'+((__t=(absURL('terms-of-service')))==null?'':_.escape(__t))+'" target="_blank"> '+((__t=(i18n("Wish's Terms of Service")))==null?'':_.escape(__t))+' </a> '+((__t=(i18n("and")))==null?'':_.escape(__t))+' <a href="'+((__t=(absURL('policy/home')))==null?'':_.escape(__t))+'" target="_blank"> '+((__t=(i18n("Policies")))==null?'':_.escape(__t))+' </a> </div> <hr/> <div class="buttons clearfix"> <div class="pull-left"> <span id="back-btn" class="btn-link text-btn onboarding-btn"> '+((__t=(i18n("Back")))==null?'':_.escape(__t))+' </span> </div> <div class="pull-right"> <span id="next-btn" class="flat-orange-btn onboarding-btn"> '+((__t=(i18n("Enter my store")))==null?'':_.escape(__t))+' </span> </div> </div> </div> ';}return __p;},"checklist_view":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="onboarding-checklist"> '; if (title !== null) { __p+=' <h3 class="title">'+((__t=(title))==null?'':_.escape(__t))+'</h3> '; } __p+=' '; if (subtitle || subtitle === null) { __p+=' <div class="subtitle alert alert-success"> '; if (subtitle === null) { __p+=' '; if (remaining_items.length === 0) { __p+=' '+((__t=(i18n("You're good to go! Click the button below to open your store now!")))==null?'':_.escape(__t))+' '; } else if (remaining_items.length === 1) { __p+=' '+((__t=(i18n("Almost there! %1$s to open your store!", remaining_items[0].text)))==null?'':_.escape(__t))+' '; } else if (remaining_items.length === 2) { __p+=' '+((__t=(i18n("Only two more steps to open your store!")))==null?'':_.escape(__t))+' '; } else { __p+=' '+((__t=(i18n("Only a few steps left to open your store!")))==null?'':_.escape(__t))+' '; } __p+=' '; } else { __p+=' '+((__t=(subtitle))==null?'':_.escape(__t))+' '; } __p+=' </div> '; } __p+=' <div class="onboarding-checklist-container"></div> '; if (bottom_btn || remaining_items.length === 0) { __p+=' <div class="onboarding-open-store-btn '+((__t=(remaining_items.length ? 'disabled' : ''))==null?'':_.escape(__t))+'"> '+((__t=(btn_text))==null?'':_.escape(__t))+' </div> '; } __p+=' </div> ';}return __p;}};});


define('tpl!checklist', function() {return {"checklist":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="checklist"> '; _.each(items, function(item, idx) { __p+=' <div class="clearfix checklist-item'+((__t=(item.complete ? ' checklist-item-complete' : ''))==null?'':_.escape(__t))+'" data-idx="'+((__t=(idx))==null?'':_.escape(__t))+'"> <div class="checklist-item-icon pull-left"> <i class="'+((__t=(item.complete ? 'fa fa-check' : ''))==null?'':_.escape(__t))+'"></i> </div> <span class="checklist-item-text pull-left"> '+((__t=(item.text))==null?'':_.escape(__t))+' </span> '; if (item.complete) { __p+=' <span class="checklist-item-btn pull-right"> '+((__t=(item.doneText))==null?'':_.escape(__t))+' </span> '; } else { __p+=' '; if (item.url === null) { __p+=' <span class="checklist-item-btn pull-right"> '+((__t=(item.btnText))==null?'':_.escape(__t))+' </span> '; } else { __p+=' <a href="'+((__t=(item.url))==null?'':_.escape(__t))+'" class="checklist-item-btn pull-right"> '+((__t=(item.btnText))==null?'':_.escape(__t))+' </a> '; } __p+=' '; } __p+=' </div> '; }); __p+=' </div> ';}return __p;}};});

define('view/Checklist',["underscore","core/bb","tpl!checklist","core/i18n"],function(_,bb,tpl,i18nModule){var i18n=i18nModule.i18n;var baseItem={text:"To do item",btnText:i18n("Go"),complete:false,btnDone:true,doneText:i18n("Done"),url:null};var ChecklistView=bb.BackboneView.extend({options:{},initialize:function(options){$.extend(true,this.options,options);this.items=_.map(options.items,function(item){var new_item={};$.extend(new_item,baseItem);$.extend(new_item,item);return new_item});this.tpl=this.buildTpl(tpl.checklist)},events:{"click .checklist-item-btn":"itemClicked"},itemClicked:function(evt){var $item=$(evt.currentTarget).closest(".checklist-item");var idx=$item.attr("data-idx");this.trigger("itemClicked",idx)},render:function(){this.$el.html(this.tpl({items:this.items}));return this}});return ChecklistView});
define('view/OnboardingChecklist',["underscore","core/bb","tpl!new_onboarding","core/i18n","core/url","view/Checklist"],function(_,bb,tpl,i18nModule,urlModule,ChecklistView){var i18n=i18nModule.i18n;var absURL=urlModule.absURL;var OnboardingChecklistView=bb.BackboneView.extend({options:{merchant:null,step_dict:null,title:i18n("Open your store"),subtitle:null,btn_text:i18n("Open my store"),bottom_btn:true},urls:{1:null,2:null,3:absURL("request-confirmation-email"),4:absURL("request-confirmation-by-phone"),5:absURL("payment-settings"),6:absURL("add-products"),7:absURL("merchant/extra-info"),8:absURL("confirm-terms-of-service")},initialize:function(options){$.extend(true,this.options,options);this.merchant=this.options.merchant;this.step_dict=this.options.step_dict;this.tpl=this.buildTpl(tpl.checklist_view);this.completed=this.merchant.new_onboarding_steps_completed},events:{"click .onboarding-open-store-btn":"openStoreClicked"},itemClicked:function(idx){idx++},canOpenStore:function(){return this.merchant.new_onboarding_steps_completed.length>=this.merchant.new_onboarding_steps_required.length},openStoreClicked:function(){if(this.canOpenStore()){window.location.href=absURL("brand-authorization/education")}},updateSteps:function(merchant_user){var completed=merchant_user.new_onboarding_steps_completed;var difference=_.difference(completed,this.completed);this.completed=completed;this.merchant=merchant_user;this.render();if(difference.length>0){var selectors=_.map(difference,_.bind(function(step){return'.checklist > .checklist-item[data-idx="'+(step-1)+'"]'},this));var selector=selectors.join(",");var $items=this.$(selector);$items.addClass("updated");window.setTimeout(function(){$items.removeClass("updated")},1e3)}},render:function(){var steps=_.pick(this.step_dict,this.merchant.new_onboarding_steps_required);var items=_.map(steps,_.bind(function(text,idx){var complete=_.contains(this.completed,parseInt(idx));return{text:text,complete:complete,url:this.urls[idx]}},this));var remaining_items=_.filter(items,function(item){return!item.complete});var tplContext={remaining_items:remaining_items};$.extend(tplContext,this.options);this.$el.html(this.tpl(tplContext));var checklist=new ChecklistView({el:this.$el.find(".onboarding-checklist-container"),items:items,title:this.options.title,subtitle:this.options.subtitle,btn_text:this.options.btn_text});checklist.on("itemClicked",_.bind(this.itemClicked,this));checklist.render();if(this.canOpenStore()){this.$(".onboarding-open-store-btn").removeClass("disabled")}return this}});return OnboardingChecklistView});
define('view/modal/OnboardingChecklist',["underscore","view/modal/BaseModal","tpl!modals/onboarding_checklist","core/i18n","view/OnboardingChecklist"],function(_,BaseModalView,tpl,i18nModule,OnboardingChecklistView){var i18n=i18nModule.i18n;var OnboardingChecklistModalView=BaseModalView.extend({options:{modal_title:i18n("Open your store"),title:null,bottom_btn:true},initialize:function(options){$.extend(true,this.options,options);this.tpl=this.buildTpl(tpl.modal)},events:{},updateSteps:function(merchant_user){this.checklist.updateSteps(merchant_user)},render:function(){this.modal_el=this.tpl(this.options);this.launchModal(this.modal_el);this.checklist=new OnboardingChecklistView(this.options);this.checklist.setElement(this.$el.find(".modal-body"));this.checklist.render();return this}});return OnboardingChecklistModalView});

define('tpl!modals/confirmation_modal', function() {return {"modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal confirmation-modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> <div class=" '; if(use_alert) { __p+=' alert alert-'+((__t=(alert))==null?'':_.escape(__t))+' '; } __p+=' "> '; if(bold_message) { __p+=' <strong> '; } __p+=' '; _.each(message.split("\n"), function(chunk) { __p+=' '+((__t=(chunk))==null?'':_.escape(__t))+'</br> '; }); __p+=' '; if(bold_message) { __p+=' </strong> '; } __p+=' </div> </div> <div class="modal-footer"> '; if (!hide_cancel_text) { __p+=' <a href="#" data-dismiss="modal" class="btn cancel-btn">'+((__t=(cancel_txt))==null?'':_.escape(__t))+'</a> '; } __p+=' <a href="#" data-dismiss="modal" class="btn btn-primary confirm-btn"> '+((__t=(confirm_txt))==null?'':_.escape(__t))+'</a> </div> </div> ';}return __p;}};});

define('view/modal/ConfirmationModal',["view/modal/BaseModal","tpl!modals/confirmation_modal"],function(BaseModalView,tpl){var ConfirmationModal=BaseModalView.extend({initialize:function(title,message,cancel_txt,confirm_txt,alert,hide_cancel_text,bold_message,use_alert){this.title=title;this.message=message;this.cancel_txt=typeof cancel_txt!=="undefined"?cancel_txt:"Cancel";this.confirm_txt=typeof confirm_txt!=="undefined"?confirm_txt:"Confirm";this.alert=typeof alert!=="undefined"?alert:"warning";this.tpl=this.buildTpl(tpl.modal);this.hide_cancel_text=typeof hide_cancel_text!=="undefined"?hide_cancel_text:false;this.bold_message=typeof bold_message!=="undefined"?bold_message:true;if(use_alert!=false){this.use_alert=true}else{this.use_alert=false}},render:function(){var modal_el=this.tpl({title:this.title,message:this.message,confirm_txt:this.confirm_txt,cancel_txt:this.cancel_txt,alert:this.alert,hide_cancel_text:this.hide_cancel_text,bold_message:this.bold_message,use_alert:this.use_alert});this.launchModal(modal_el);return this},events:{"click .confirm-btn":"clickConfirm","click .cancel-btn":"clickCancel"},clickConfirm:function(evt){this.trigger("confirm")},clickCancel:function(evt){this.trigger("cancel")}});return ConfirmationModal});
define('core/loader',["underscore","core/url"],function(_,urlModule){var _showLoader=undefined;(function($){$.fn.ajaxloading=function(selector){var show=function(){this.append('<div id="loading-overlay" style="display:none;">'+'<img src="'+"//d2ujdsqe3ri19m.cloudfront.net/36f2eef073e7/img/ajax-loader.gif?v=19"+'" />'+"</div>");this.find("#loading-overlay").fadeIn(150)};_showLoader=window.setTimeout(_.bind(show,this),100);return this};$.fn.ajaxfinished=function(){window.clearTimeout(_showLoader);this.find("#loading-overlay").remove()}})(jQuery)});

define('tpl!modals/merchant_support_ticket', function() {return {"modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div id="support-ticket-modal" class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(i18n("Contact us")))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body" style="max-height: 420px;overflow-y: auto;"> <form id="support-ticket-form" class="form-horizontal"> <div class="control-group"> <label class="control-label" for="user_name">'+((__t=(i18n("Name")))==null?'':_.escape(__t))+':</label> <div class="controls"> <input type="text" id="user_name" value="'+((__t=(name))==null?'':_.escape(__t))+'" required> </div> </div> <div class="control-group"> <label class="control-label" for="user_email">'+((__t=(i18n("Email")))==null?'':_.escape(__t))+':</label> <div class="controls"> <input type="email" id="user_email" value="'+((__t=(email))==null?'':_.escape(__t))+'" required> </div> </div> <div class="control-group"> <label class="control-label" for="merchant_name">'+((__t=(i18n("Merchant Name")))==null?'':_.escape(__t))+':</label> <div class="controls"> <input type="text" id="merchant_name" value="'+((__t=(merchant_display_name))==null?'':_.escape(__t))+'" required> </div> </div> <div class="control-group"> <label class="control-label" for="merchant_id">'+((__t=(i18n("Merchant ID")))==null?'':_.escape(__t))+':</label> <div class="controls"> <input type="text" id="merchant_id" value="'+((__t=(merchant_id))==null?'':_.escape(__t))+'" required> </div> </div> <div class="control-group"> <label class="control-label" for="product_id">'+((__t=(i18n("Product ID")))==null?'':_.escape(__t))+':</label> <div class="controls"> <input type="text" id="product_id" placeholder="(optional)"> </div> </div> <div class="control-group"> <label class="control-label" for="order_id">'+((__t=(i18n("Order ID")))==null?'':_.escape(__t))+':</label> <div class="controls"> <input type="text" id="order_id" placeholder="(optional)"> </div> </div> <div class="control-group"> <label class="control-label" for="ticket_content">'+((__t=(i18n("How can we help you?")))==null?'':_.escape(__t))+'</label> <div class="controls"> <textarea id="ticket_content" placeholder="(required)" required></textarea> <div class="character-limit"> <div id="character-count">0</div>/'+((__t=(max_character_count))==null?'':_.escape(__t))+' </div> <div class="error-label hide"></div> </div> </div> </form> </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn">'+((__t=(i18n("Cancel")))==null?'':_.escape(__t))+'</a> <a class="btn btn-primary" id="submit-button">'+((__t=(i18n("Submit")))==null?'':_.escape(__t))+'</a> </div> </div> ';}return __p;}};});

define('core/dom_utils',[],function(){function val(el){return $.trim($(el).hasClass("watermark")?"":$(el).val())}return{val:val}});
define('view/modal/MerchantSupportTicketModal',["core/api","core/loader","view/modal/BaseModal","tpl!modals/merchant_support_ticket","core/dom_utils","core/i18n","view/modal/ConfirmationModal"],function(api,loader,BaseModalView,tpl,dom_utils,i18n,ConfirmationModal){var i18n=i18n.i18n;var MerchantSupportTicketModalView=BaseModalView.extend({initialize:function(merchant,max_character_count,locale){this.tpl=this.buildTpl(tpl.modal);this.max_character_count=max_character_count;this.merchant=merchant;this.locale=locale},render:function(){this.modal_el=this.tpl({max_character_count:this.max_character_count,name:this.merchant.name,email:this.merchant.email,merchant_id:this.merchant.merchant_id,merchant_display_name:this.merchant.display_name});this.launchModal(this.modal_el)},events:{"click #submit-button":"submitTicket","keyup #ticket_content":"updateCharacterCount","keypress #ticket_content":"updateCharacterCount"},isEmail:function(email){var regex=/^([\x00-\x7F])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return regex.test(email)},submitTicket:function(evt){var name=$.trim($("#user_name").val());var email=$.trim($("#user_email").val());var merchant_name=$.trim($("#merchant_name").val());var merchant_id=$.trim($("#merchant_id").val());var product_id=$.trim($("#product_id").val());var order_id=$.trim($("#order_id").val());var content=$.trim($("#ticket_content").val());if(name==""){$("#support-ticket-form .error-label").html("You must provide a name").removeClass("hide");return}if(!this.isEmail(email)){$("#support-ticket-form .error-label").html("You must provide a valid email").removeClass("hide");return}if(merchant_name==""){$("#support-ticket-form .error-label").html("You must provide a merchant name").removeClass("hide");return}if(merchant_id==""){$("#support-ticket-form .error-label").html("You must provide a merchant ID").removeClass("hide");return}if(content==""){$("#support-ticket-form .error-label").html("You must tell us how we can help you").removeClass("hide");return}if(content.length>this.max_character_count){$("#support-ticket-form .error-label").html("Your content is too long").removeClass("hide");return}this.errors=0;var param={user_email:email,user_name:name,content:content,merchant_name:merchant_name,merchant_id:merchant_id,product_id:product_id,order_id:order_id};this.submitTicketAPICall(param)},submitTicketAPICall:function(param){api.call("create-merchant-support-ticket",param,_.bind(function(resp){this.ajaxCallReturned()},this),_.bind(function(resp){this.errors+=1;this.apiError(resp);this.ajaxCallReturned()},this))},ajaxCallReturned:function(){if(this.errors<=0){$("#support-ticket-modal").modal("hide");if(this.locale=="zh"){api.launchSuccessModal("您已成功联系商户客服小智，我们已发送一封"+"确认邮件至您的邮箱，并将在一个工作日内回复您的问题，请注意查收哦。")}else{api.launchSuccessModal("Your merchant support ticket has been "+"successfully submitted. We will get back to you via your"+" email within 1 business day.")}}$("body").ajaxfinished()},updateCharacterCount:function(evt){this.character_count=dom_utils.val(this.$("#ticket_content")).length;this.$("#character-count").html(this.character_count)}});return MerchantSupportTicketModalView});
define('base_page',["backbone","core/bb","core/api","domReady","lib/jquery.cookie","core/url","core/i18n","view/modal/OnboardingChecklist","view/modal/ConfirmationModal","view/modal/MerchantSupportTicketModal"],function(Backbone,bb,api,domReady,Cookie,urlModule,i18n,OnboardingChecklistModal,ConfirmationModal,MerchantSupportTicketModalView){var i18n=i18n.i18n;var error_logger_initialize=function(){window.onerror=function(errorMsg,url,lineNumber){var currTime=(new Date).getTime();var lastLogTime=$.cookie("last_error_log_time");if(lastLogTime&&currTime-lastLogTime<1e3){return}$.cookie("last_error_log_time",currTime);api.call("log-js-error",{error_msg:errorMsg,url:url,line_number:lineNumber})}};var log_client_pref=function(){if(window.performance&&window.performance.timing&&window.pageParams&&window.pageParams.monitor_key){var perf_data={};for(attribute in window.performance.timing){if(typeof window.performance.timing[attribute]=="number"){perf_data[attribute]=window.performance.timing[attribute]}}perf_data.uid=window.pageParams.monitor_key;api.call("client-perf",perf_data,function(){},function(){})}};var core_page_initialize=function(){window.session_expiry=window.pageParams.session_expiry*1e3;window.update_session_expiry=function(){if(window.session_expiry_timer){window.clearTimeout(window.session_expiry_timer)}if(window.session_expiry_modal_timer){window.clearTimeout(window.session_expiry_modal_timer)}var dt1=window.session_expiry-(new Date).getTime()+2*1e3;var dt2=window.session_expiry-(new Date).getTime()-60*1e3;window.session_expiry_timer=window.setTimeout(function(){location.reload()},dt1);window.session_expiry_modal_timer=window.setTimeout(function(){var modal=new ConfirmationModal("Session Expiring",i18n("Your online session will end in 60 seconds due to inactivity.\n\nFor your security, sessions will automatically expire after a period of inactivity. This greatly decreases the chance that someone will access your account if you forget to log out.\n\nIf you are still working on your session, click OK to continue."),"Cancel","OK");modal.use_alert=false;modal.bold_message=false;modal.on("confirm",function(){location.reload()});modal.render()},dt2)};if(window.session_expiry){window.update_session_expiry()}var $subnav=$("#sub-header-nav");if($subnav.height()>41){var $page_content=$(".banner-container");var top_margin=$subnav.height()-2+"px";$page_content.css("margin-top",top_margin)}};var init_onboarding=function(){var merchant=window.pageParams.merchant_user;if(merchant&&merchant.is_new_merchant_lead){var step_dict=window.pageParams.onboarding_step_dict;var modal=new OnboardingChecklistModal({merchant:merchant,step_dict:step_dict});var launch_onboarding_modal=function(){modal.render()};$(".btn-open-onboarding-checklist-modal").click(launch_onboarding_modal);$(document).on("refreshOnboardingChecklist",function(){api.call("merchant-user/get",{},function(resp){modal.render();modal.updateSteps(resp.data.merchant_user)})})}};var core_page_finish=function(){bb.startHistory();error_logger_initialize();log_client_pref();$("#page-content").tooltip({selector:"[rel=tooltip]"});popups();remind_payment_settings();initalize_language_selector();initialize_su();$(window).scroll(function(){if($(window).width()<1024){$(".navbar").css({left:0-$(window).scrollLeft()+"px"})}else{$(".navbar").css({left:"0"})}});$(window).resize(function(){var $subnav=$("#sub-header-nav");if($subnav.height()>=41){var $page_content=$(".banner-container");var top_margin=$subnav.height()-2+"px";$page_content.css("margin-top",top_margin)}});$("a.signup_guide_link").on("click",function(){api.call("log-signup-guide-clicked",{})});$(".merchant-support").click(function(e){e.preventDefault();var max_character_count=4e3;var merchant=window.pageParams.merchant_user;locale="en";if($(".china-col").hasClass("selected")){locale="zh"}new MerchantSupportTicketModalView(merchant,max_character_count,locale).render();return false});init_onboarding();var lower_right_merchant_support=$("#lower-right-merchant-support");lower_right_merchant_support.bind("click",track_merchant_support_click);if(window.pageParams.show_zendesk_chat===true){var zendesk_bind_counter=0;var zendesk_set_timer=setTimeout(function(){var zendesk_set_interval=setInterval(function(){var zendesk_chat_button=$("#launcher").contents().find(".src-component-Launcher-wrapper");if(zendesk_chat_button.length>0){zendesk_chat_button.unbind("click",track_zendesk_support_click).bind("click",track_zendesk_support_click);clearTimeout(zendesk_set_timer);clearInterval(zendesk_set_interval)}else{if(++zendesk_bind_counter>10){clearTimeout(zendesk_set_timer);clearInterval(zendesk_set_interval)}}},1e3)},1e3)}};var track_merchant_support_click=function(){var params={pathname:window.location.pathname,button_type:"merchant_support",button_location:"lower_right"};track_merchant_support_api(params)};var track_zendesk_support_click=function(evt){var button_location=evt.isTrigger?"home_page":"lower_right";var params={pathname:window.location.pathname,button_type:"zendesk",button_location:button_location};track_merchant_support_api(params)};var track_merchant_support_api=function(params){api.call("track-merchant-support",params,function(resp){},function(resp){})};var initalize_language_selector=function(){$(".lang-sel").on("click",function(evt){var locale=$(evt.currentTarget).attr("data-lang");api.call("change-locale",{locale:locale},function(resp){window.location.reload()})})};var initialize_su=function(){loginAs=function(evt){var $el=$(evt.currentTarget);var bd_client=$el.attr("data-uid");api.call("login-as",{bd_client:bd_client},function(resp){window.open(urlModule.absURL("/"),"_blank")})};$(document).on("click",".login-as-button",loginAs)};var popups=function(){$("#show-tfa-banner .close").click(function(e){$.cookie("show-tfa-banner","closed",{path:"/"})});if($.cookie("show-tfa-banner")==="closed"){$("#show-tfa-banner").hide()}$("#merchant-china-redirect .close").click(function(e){$.cookie("china-redirect","closed",{path:"/"})});if($.cookie("china-redirect")!=="closed"){$("#merchant-china-redirect").show().delay(1e3).animate({bottom:"50px"},1500)}};var remind_payment_settings=function(){if($.cookie("require_payment_info")=="1"&&window.pageParams.current_step===undefined){$("#menu-account").popover({html:true,content:'<div class="info-popover">You have not setup your '+"payment settings, please tell us how you would like "+'to be paid.<br><a class="now">Do it now</a> '+'| <a class="later">Hide</a></div>',placement:"bottom",trigger:"manual"});$("#menu-account").popover("show");$("#menu-account, .info-popover .later").click(function(){$("#menu-account").popover("destroy");document.cookie="require_payment_info=;"+"expires=Thu, 01 Jan 1970 00:00:01 GMT;"});$(".info-popover .now").click(function(){window.location.href="/payment-settings";document.cookie="require_payment_info=;"+"expires=Thu, 01 Jan 1970 00:00:01 GMT;"})}};var on_dom_ready=function(init_function){domReady(function(){core_page_initialize();init_function();core_page_finish()})};var virtual_pageview=function(page){if(typeof _gaq!=="undefined"){_gaq.push(["_trackPageview","/virtual/"+page])}};return{onDomReady:on_dom_ready,virtual_pageview:virtual_pageview}});
define('lib/criteo',[],function(){var CRITEO_ACCT_ID=31864;var geo_acct_map={US:CRITEO_ACCT_ID,AU:32659,CA:32660,CH:32661,DE:32662,FR:32663,IT:32664,SE:32665,GB:32668,BE:36489,DK:36312,FI:36490,NZ:36222};function getCriteoAccountId(){var cc=window.country_code;var acct_id=CRITEO_ACCT_ID;return acct_id}function criteoLoaded(){var criteo_defined=typeof window.criteo_q!=="undefined";var criteo_not_null=window.criteo_q!=null;return criteo_defined&&criteo_not_null}function criteoViewSplashPage(siteType){if(!criteoLoaded()){return}window.criteo_q.push({event:"setAccount",account:getCriteoAccountId()},{event:"setSiteType",type:siteType},{event:"setEmail",email:""},{event:"viewHome",merchant:"1",merchantpage:"0"})}function criteoViewSignupStep(siteType,merchantEmail,step){if(!criteoLoaded()){return}window.criteo_q.push({event:"setAccount",account:getCriteoAccountId()},{event:"setSiteType",type:siteType},{event:"setEmail",email:merchantEmail},{event:"viewItem",item:"merchantitem",merchant:"1",merchantpage:step.toString()})}function criteoViewSignupPage(siteType){criteoViewSignupStep(siteType,"",1)}function criteoViewOnboardingContactPage(siteType,merchantEmail){criteoViewSignupStep(siteType,merchantEmail,2)}function criteoViewOnboardingStoreInfoPage(siteType,merchantEmail){criteoViewSignupStep(siteType,merchantEmail,3)}function criteoFinishSignup(siteType,merchantEmail){if(!criteoLoaded()){return}window.criteo_q.push({event:"setAccount",account:getCriteoAccountId()},{event:"setSiteType",type:siteType},{event:"setEmail",email:merchantEmail},{event:"trackTransaction",merchant:"1",item:[{id:"merchantitem",price:1,quantity:1}]})}return{criteoViewSplashPage:criteoViewSplashPage,criteoViewSignupPage:criteoViewSignupPage,criteoViewOnboardingContactPage:criteoViewOnboardingContactPage,criteoViewOnboardingStoreInfoPage:criteoViewOnboardingStoreInfoPage,criteoFinishSignup:criteoFinishSignup}});
require(["underscore","base_page","core/bb","core/api","lib/criteo"],function(_,base_page,bb,api,criteo){var WelcomePageView=bb.BackboneView.extend({initialize:function(){if(window.pageParams.use_ad_tag&&criteo){criteo.criteoViewSplashPage("d")}this.setElement($("#page-content"));this.focusSection=null;$(".subheader-link").click(function(evt){var button=$(evt.currentTarget);var sectionName=button.attr("data");var section=$("#"+sectionName);var offset=section.offset().top-150;window.scroll(0,offset);var link=0;if(sectionName=="start-benefit"){link="benefits"}else if(sectionName=="start-get-started"){link="get-started"}else if(sectionName=="start-testimonials"){link="testimonials"}else if(sectionName=="start-pricing"){link="pricing"}else if(sectionName=="start-about"){link="about"}else if(sectionName=="start-faq"){link="faq"}else{return}api.call("log-splash-click-"+link,{})})},events:{"click #signup-btn":"signupClicked","keyup .signup-email":"signupEmailKeyup"},signupEmailKeyup:function(evt){if(evt.which==13){var input=$(evt.currentTarget);var button=input.parent().find(".signup-btn");button.click()}},signupClicked:function(evt){var button=$(evt.currentTarget);var input=button.parent().find(".signup-email");var email=input.val().trim();if(email!=""){window.location.href="/signup?email="+encodeURIComponent(email)}else{window.location.href="/signup"}}});var init_page=function(){var page=new WelcomePageView};base_page.onDomReady(init_page)});
define("page/welcome_page", function(){});

